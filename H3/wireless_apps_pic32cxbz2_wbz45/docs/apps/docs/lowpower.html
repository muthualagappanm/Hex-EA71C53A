<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="http://10.12.80.161:4000/wireless/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Low Power | Microchip MPLAB Harmony Wireless help</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Low Power" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony Wireless package" /> <meta property="og:description" content="Harmony Wireless package" /> <link rel="canonical" href="lowpower.html" /> <meta property="og:url" content="http://10.12.80.161:4000/wireless/apps/docs/lowpower.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony Wireless help" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Low Power" /> <script type="application/ld+json"> {"@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://10.12.80.161:4000/wireless/assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"http://10.12.80.161:4000/wireless/apps/docs/lowpower.html","headline":"Low Power","description":"Harmony Wireless package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="lowpower.html#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="../../index.html" class="nav-list-link">Mplab Code Configurator Wireless Package</a></li><li class="nav-list-item active"><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../readme.html" class="nav-list-link">Examples applications</a><ul class="nav-list "><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/readme.html" class="nav-list-link">BLE Building Blocks</a><ul class="nav-list"><li class="nav-list-item "> <a href="../ble/building_blocks/peripheral/readme.html" class="nav-list-link">Peripheral Building Blocks</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/scan_ext_adv/readme.html" class="nav-list-link">BLE Extended Scan</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/readme.html" class="nav-list-link">Central Building Blocks</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/connection/readme.html" class="nav-list-link">BLE Connection(Central)</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/profiles_services/readme.html" class="nav-list-link">BLE Profiles and Services (Central)</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/profiles_services/trp_uart/readme.html" class="nav-list-link">Central Transparent UART</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/profiles_services/ml_trp_uart/readme.html" class="nav-list-link">Multi Transparent UART</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/chip_peripherals/uart/readme.html" class="nav-list-link">UART Demo</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/freertos_ble_stack_init_central.html" class="nav-list-link">Freetos Stack Init</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/peripheral/legacy_adv_sleep/readme.html" class="nav-list-link">Legacy Advertisement</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/central/legacy_scan/readme.html" class="nav-list-link">Legacy Scan</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/peripheral/connection/readme.html" class="nav-list-link">Peripheral Connection</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/peripheral/ext_adv/readme.html" class="nav-list-link">Extended Advertisement</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/peripheral/profiles_services/readme.html" class="nav-list-link">Profile and Services</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/peripheral/profiles_services/custom_service/readme.html" class="nav-list-link">Custom Service</a> </li><li class="nav-list-item "> <a href="../ble/building_blocks/peripheral/profiles_services/trp_uart/readme.html" class="nav-list-link">Proprietary UART Service</a> </li></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/advanced_applications/readme.html" class="nav-list-link">BLE Advance Applications</a><ul class="nav-list"><li class="nav-list-item "> <a href="../ble/advanced_applications/ble_uart_demo/readme.html" class="nav-list-link">BLE UART Demo</a> </li><li class="nav-list-item "> <a href="../ble/advanced_applications/ble_sensor_app/readme.html" class="nav-list-link">BLE Sensor DEMO</a> </li><li class="nav-list-item "> <a href="../ble/advanced_applications/ble_sensor_app/protocol.html" class="nav-list-link">BLE Sensor (Protocol Exchange)</a> </li></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../zigbee/readme.html" class="nav-list-link">Zigbee</a><ul class="nav-list"><li class="nav-list-item "> <a href="../zigbee/low_power_configuration.html" class="nav-list-link">Zigbee Low Power Config</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_commissioning.html" class="nav-list-link">Zigbee Commissioning Procedure</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_greenpower.html" class="nav-list-link">Zigbee Green Power</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_project_generation.html" class="nav-list-link">Zigbee Application Project Generation</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_security_model.html" class="nav-list-link">Zigbee Network Security Models</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_combined_interface/readme.html" class="nav-list-link">Zigbee Combined Interface</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_lights/readme.html" class="nav-list-link">Zigbee Light</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_lights/readme_distributed.html" class="nav-list-link">Zigbee light Distributed Network</a> </li><li class="nav-list-item "> <a href="../zigbee/zigbee_multisensor/readme.html" class="nav-list-link">Zigbee multisensor</a> </li></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../multiprotocol/readme.html" class="nav-list-link">Multiprotocol</a><ul class="nav-list"><li class="nav-list-item "> <a href="../multiprotocol/ble_zigbee_basic/readme.html" class="nav-list-link">BLE+ZIGBEE Application</a> </li><li class="nav-list-item "> <a href="../multiprotocol/ble_zigbee_light_prov/readme.html" class="nav-list-link">Multiprotocol Demo App</a> </li><li class="nav-list-item "> <a href="../multiprotocol/ble_zigbee_light_prov/protocol.html" class="nav-list-link">Multiprotocol Demo</a> </li><li class="nav-list-item "> <a href="../multiprotocol/ble_zigbee_multiSensor_prov/readme.html" class="nav-list-link">Zigbee Multi-Sensor, commissioning App</a> </li></ul></li><li class="nav-list-item active"><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="readme.html" class="nav-list-link">User Docs</a><ul class="nav-list"><li class="nav-list-item "> <a href="../zigbee/consoleCommands.html" class="nav-list-link">Serial Console Commands</a> </li><li class="nav-list-item active"> <a href="lowpower.html" class="nav-list-link active">Low Power</a> </li><li class="nav-list-item "> <a href="user_action.html" class="nav-list-link">User Action</a> </li><li class="nav-list-item "> <a href="generate_code.html" class="nav-list-link">MCC Code Generation</a> </li><li class="nav-list-item "> <a href="creating_new_mplabx_harmony_project.html" class="nav-list-link">Generating New MCC Harmony Code</a> </li><li class="nav-list-item "> <a href="pic32cx_bz2_wbz45x_sdk_setup.html" class="nav-list-link">SDK Setup</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../release_notes.html" class="nav-list-link">Release notes</a><ul class="nav-list "><li class="nav-list-item "><a href="../ble/advanced_applications/ble_uart_demo/release_notes.html" class="nav-list-link">BLE UART Demo</a></li><li class="nav-list-item "><a href="../ble/advanced_applications/ble_sensor_app/release_notes.html" class="nav-list-link">BLE Sensor</a></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/peripheral/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/chip_peripherals/uart/release_notes.html" class="nav-list-link">UART Hello World</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/peripheral/legacy_adv_sleep/release_notes.html" class="nav-list-link">BLE Legacy Adv</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/peripheral/ext_adv/release_notes.html" class="nav-list-link">BLE Extended Advertising</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/peripheral/connection/release_notes.html" class="nav-list-link">BLE Connection (Peripheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/peripheral/profiles_services/custom_service/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/central/connection/release_notes.html" class="nav-list-link">BLE Connection (Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/central/legacy_scan/release_notes.html" class="nav-list-link">BLE Legacy Scan</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/central/profiles_services/ml_trp_uart/release_notes.html" class="nav-list-link">BLE Multilink Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="lowpower.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../ble/building_blocks/central/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="../ble/building_blocks/central/scan_ext_adv/release_notes.html" class="nav-list-link">BLE Scan Extended Advertising</a></li><li class="nav-list-item "><a href="../multiprotocol/ble_zigbee_light_prov/release_notes.html" class="nav-list-link">Zigbee Multiprotocol Lights Prov App</a></li><li class="nav-list-item "><a href="../multiprotocol/ble_zigbee_multiSensor_prov/release_notes.html" class="nav-list-link">Zigbee Multi-Sensor and commissioning</a></li><li class="nav-list-item "><a href="../zigbee/zigbee_lights/release_notes.html" class="nav-list-link">Zigbee Combined Interface App</a></li><li class="nav-list-item "><a href="../zigbee/zigbee_combined_interface/release_notes.html" class="nav-list-link">Zigbee Combined Interface App</a></li><li class="nav-list-item "><a href="../zigbee/zigbee_multisensor/release_notes.html" class="nav-list-link">Zigbee Multi-Sensor</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony Wireless help" aria-label="Search Microchip MPLAB Harmony Wireless help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../readme.html">Examples applications</a></li> <li class="breadcrumb-nav-list-item"><a href="readme.html">User Docs</a></li> <li class="breadcrumb-nav-list-item"><span>Low Power</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a></p> <h1 id="low-power-introduction"> <a href="lowpower.html#low-power-introduction" aria-labelledby="low-power-introduction" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Low Power Introduction</strong> </h1> <p>EA3.1 release has system sleep/standby mode implemented as part of Harmony framework for WBZ451. In order for the device to enter sleep mode, Bluetooth/Zigbee wireless subsytem should be ready to go to sleep. BLE/Zigbee can enter sleep if there is no active data tx/reception or the ble advertisement interval/connection interval/zigbee polling period have not expired. So the system sleep cannot be directly edited as a parameter. During system sleep, clock (system PLL) will be disabled and syatem tick will be turned off. FreeRTOS timer needs to be componsated for the time spent in sleep. RTC timer which works in the sleep mode is used to accomplish this. So overall system sleep time is determined by the following factors - BLE/Zigbee activity interval, RTC timer, external interrupt (like GPIO).</p> <h1 id="sleep-mode-entry-implementation-details"> <a href="lowpower.html#sleep-mode-entry-implementation-details" aria-labelledby="sleep-mode-entry-implementation-details" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Sleep Mode Entry Implementation Details</strong> </h1> <ol> <li>FreeRTOS provides Tickless IDLE Mode for power saving, this can be used to stop periodic tick interrupts during idle periods (periods when there are no application tasks that are able to excute) For the lost count on time during the IDLE mode, RTC timer is used to make a correcting adjustment to the RTOS tick count value, when it is restarted (after waking up from sleep) More information on low power tickless mode is available <a href="https://www.freertos.org/low-power-tickless-rtos.html">here</a>. The Tickless Idle Mode will be executed automatically when the Idle task is the only task able to run, because all the application tasks are either in blocked or suspended state. To prevent the system from entering sleep mode and waking up immediately, the minimum sleep time(IDLE time) is automatically set to 5 ms.</li> </ol> <p><strong>Note:</strong> maximum sleep time is equal to the maximum period of the RTC 32 bit counter - 134217.8 sec (around 37 hours)</p> <ol> <li> <p>In order for the system to enter sleep, system needs to request bluetooth/zigbee wireless subsystem to sleep. This is accomplished by calling API - BT_SYS_EnterSleepMode() for BLE and API - ZB_ReadyToSleep() for Zigbee These API’s ensure that the BLE/Zigbee stack can go to sleep</p> <p><img src="media/ble_lp1.PNG" alt="" /></p> <p><img src="media/ble_lp13.PNG" alt="" /></p> </li> <li> <p>The API to call to ensure subsytem is sleeping (inactive) or ready for system to enter sleep mode is - BT_SYS_AllowSystemSleep, for zigbee the ZB_ReadyToSleep() API ensures this</p> <p><img src="media/ble_lp2.PNG" alt="" /></p> </li> <li>If the expected sleep time is greater than 5 ms, system is allowed to enter sleep mode by checking for 2 conditions <ul> <li>Bluetooth/Zigbee subsystem is inactive</li> <li>eTaskConfirmSleepModeStatus() returns eNoTasksWaitingTimeout, more information <a href="https://www.freertos.org/eTaskConfirmSleepModeStatus.html">here</a>. <blockquote> <p><strong>Tip:</strong> User can also add their own condition to be checked before system goes to sleep, for example, do not enter system sleep if data transmission over UART is active</p> </blockquote> </li> </ul> <p>Pseudo code in RTC based Tickless Idle Mode:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> if ((BT_SYS_AllowSystemSleep() || ZB_ReadyToSleep()) &amp;&amp; ( eTaskConfirmSleepModeStatus() != eAbortSleep ) &amp;&amp; (user_condition))
 {
         //Enter System Sleep Mode
         DEVICE_EnterSleepMode ();        //RTC Based Tickless Idle Mode       
 }
</code></pre></div> </div> </li> <li> <p>When both the conditions as mentioned in point 3 are met, we enter RTC based Tickless Idle mode (Stop the system tick, use of RTC timer to set the sleep time, disable interrupts)</p> </li> <li> <p>System will enter sleep mode after setting the RTC based Tickless Idle Mode by calling API - Device_EnterSleepMode() and then wait for Interrupt (WFI) instruction is executed</p> <p><img src="media/ble_lp3.PNG" alt="" /></p> </li> </ol> <h1 id="sleep-mode-exit-details"> <a href="lowpower.html#sleep-mode-exit-details" aria-labelledby="sleep-mode-exit-details" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Sleep Mode Exit Details</strong> </h1> <ol> <li> <p>Sytem when in sleep/standby mode can be waken up by RTC timeout, BLE/Zigbee or GPIO interrupt</p> </li> <li> <p>Sleep mode exit is initiated by calling API - DEVICE_ExitSleepMode()</p> </li> <li> <p>Upon exiting the sleep mode, interrupts need to be reenabled to allow the inteerupt service routine to be executed</p> </li> <li> <p>Interrupts are disabled as the sys tick needs to be compensated (Tickless IDLE mode)</p> <p><img src="media/ble_lp4.PNG" alt="" /></p> </li> </ol> <h1 id="system-sleep-and-wakeup-flow"> <a href="lowpower.html#system-sleep-and-wakeup-flow" aria-labelledby="system-sleep-and-wakeup-flow" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>System Sleep and Wakeup Flow</strong> </h1> <p><img src="media/ble_lp12.PNG" alt="" /></p> <h1 id="how-to-use-mplab-code-configurator-to-generate-sleep-mode"> <a href="lowpower.html#how-to-use-mplab-code-configurator-to-generate-sleep-mode" aria-labelledby="how-to-use-mplab-code-configurator-to-generate-sleep-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>How to use MPLAB Code Configurator to Generate Sleep Mode</strong> </h1> <ol> <li> <p>Sytem Sleep Mode needs to be enabled in BLE stack H3 compoenent configuration, after enabling this dependant components like RTC (Timer source during sleep) will be requested to be enabled</p> <p><img src="media/ble_lp5.PNG" alt="" /></p> <p>For Zigbee applications the System Sleep mode is only enabled when using the following device types - Multisensor, Intruder Alarm System and Color Scene controller as per the Zigbee End Device Spec. There is no seperate configuration that a user has to select to enable the System Sleep like for BLE Sleep</p> </li> <li>Upon enabling sleep mode, FreeRTOS related settings will be set automatically <ul> <li>Tick Mode will be set to Tickless_Idle</li> <li>Expected idle time before sleep will be set to 5 (ms) <img src="media/ble_lp6.PNG" alt="" /></li> <li>Tick Hook will be enabled (For user to add any custom code needed to be executed within each tick interrupt) <img src="media/ble_lp7.PNG" alt="" /></li> <li>RTC peripheral library will be added and configured <img src="media/ble_lp7.PNG" alt="" /></li> </ul> <p><strong>Note:</strong> RTC counter should not be reset (RTC_Timer32CounterSet()) arbitrarily when the system is running</p> </li> <li>RTC clock source should be set manually, there are 4 options to choose from <ul> <li>FRC (±1% offset)</li> <li>LPRC ( with larger offset, &lt; ±5%)</li> <li>POSC &lt;- Candidate of the clock source (better clock accuracy)</li> <li>SOSC &lt;- Candidate of the clock source (better clock accuracy)</li> </ul> <p><strong>Note:</strong> Users must select POSC/SOSC as the RTC clock source as choosing other clock sources will impact BLE connection stability</p> </li> <li> <p>Manually Setting RTC clock source - POSC, open MCC, select “Clock Configuration” and configure as highlighted <img src="media/ble_lp10.PNG" alt="" /> <img src="media/ble_lp9.PNG" alt="" /></p> </li> <li> <p>Manually Setting RTC clock source - SOSC, open MCC, select “Clock Configuration” and configure as highlighted <img src="media/ble_lp10.PNG" alt="" /> <img src="media/ble_lp11.PNG" alt="" /></p> <p><strong>Note:</strong> Users can only select one clock source POSC or SOSC, steps are mentioned to choose either</p> </li> <li> <p>It is recommended to use 48MHz as SYS_CLOCK for better power savings. This can be configured by setting SPLLPOSTDIV1 to <code class="language-plaintext highlighter-rouge">2</code> as shown below. <img src="media/lowpower_user_action7.png" alt="" /></p> </li> <li> <p>Ensure that JTAG Enable is disabled by clearing the JTAGEN bit in CFGCON0 (Configuration Control Register 0) as shown below.</p> <p><code class="language-plaintext highlighter-rouge">CFG_REGS-&gt;CFG_CFGCON0CLR = CFG_CFGCON0_JTAGEN_Msk;</code></p> </li> <li> <p>All Unused pins in the application needs to be set in input mode and the pulldown should be enabled for these pins. This can be configured through pin configuration in Harmony3 Configurator as shown below. <img src="media/lowpower_user_action6.png" alt="" /></p> </li> <li>Generate Code <a href="generate_code.html">link</a> for instructions</li> </ol> <h1 id="sleep-related-code-implementation-location"> <a href="lowpower.html#sleep-related-code-implementation-location" aria-labelledby="sleep-related-code-implementation-location" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Sleep related code implementation location</strong> </h1> <div class="table-wrapper"><table> <thead> <tr> <th><strong>Implementation</strong></th> <th><strong>Location</strong></th> </tr> </thead> <tbody> <tr> <td>BT Sleep Mode</td> <td>BLE Stack Library</td> </tr> <tr> <td>Zigbee Sleep Mode</td> <td>Zigbee Stack Library</td> </tr> <tr> <td>System Sleep Mode</td> <td>Device Support Library</td> </tr> <tr> <td>Execute BT/System Sleep</td> <td>app_idle_task.c</td> </tr> <tr> <td>RTC Based Tickless Idle Mode</td> <td>app_idle_task.c</td> </tr> </tbody> </table></div> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='http://10.12.80.161:4000/wireless/assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2022 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
