<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="http://10.12.80.161:4000/wireless/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>BLE UART Demo | Microchip MPLAB Harmony Wireless help</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="BLE UART Demo" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony Wireless package" /> <meta property="og:description" content="Harmony Wireless package" /> <link rel="canonical" href="readme.html" /> <meta property="og:url" content="http://10.12.80.161:4000/wireless/apps/ble/advanced_applications/ble_uart_demo/readme.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony Wireless help" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="BLE UART Demo" /> <script type="application/ld+json"> {"@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://10.12.80.161:4000/wireless/assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"http://10.12.80.161:4000/wireless/apps/ble/advanced_applications/ble_uart_demo/readme.html","headline":"BLE UART Demo","description":"Harmony Wireless package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="readme.html#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="../../../../index.html" class="nav-list-link">Mplab Code Configurator Wireless Package</a></li><li class="nav-list-item active"><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../readme.html" class="nav-list-link">Examples applications</a><ul class="nav-list "><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/readme.html" class="nav-list-link">BLE Building Blocks</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../building_blocks/peripheral/readme.html" class="nav-list-link">Peripheral Building Blocks</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/scan_ext_adv/readme.html" class="nav-list-link">BLE Extended Scan</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/readme.html" class="nav-list-link">Central Building Blocks</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/connection/readme.html" class="nav-list-link">BLE Connection(Central)</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/profiles_services/readme.html" class="nav-list-link">BLE Profiles and Services (Central)</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/profiles_services/trp_uart/readme.html" class="nav-list-link">Central Transparent UART</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/profiles_services/ml_trp_uart/readme.html" class="nav-list-link">Multi Transparent UART</a> </li><li class="nav-list-item "> <a href="../../building_blocks/chip_peripherals/uart/readme.html" class="nav-list-link">UART Demo</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/freertos_ble_stack_init_central.html" class="nav-list-link">Freetos Stack Init</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/legacy_adv_sleep/readme.html" class="nav-list-link">Legacy Advertisement</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/legacy_scan/readme.html" class="nav-list-link">Legacy Scan</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/connection/readme.html" class="nav-list-link">Peripheral Connection</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/ext_adv/readme.html" class="nav-list-link">Extended Advertisement</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/profiles_services/readme.html" class="nav-list-link">Profile and Services</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/profiles_services/custom_service/readme.html" class="nav-list-link">Custom Service</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/profiles_services/trp_uart/readme.html" class="nav-list-link">Proprietary UART Service</a> </li></ul></li><li class="nav-list-item active"><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../readme.html" class="nav-list-link">BLE Advance Applications</a><ul class="nav-list"><li class="nav-list-item active"> <a href="readme.html" class="nav-list-link active">BLE UART Demo</a> </li><li class="nav-list-item "> <a href="../ble_sensor_app/readme.html" class="nav-list-link">BLE Sensor DEMO</a> </li><li class="nav-list-item "> <a href="../ble_sensor_app/protocol.html" class="nav-list-link">BLE Sensor (Protocol Exchange)</a> </li></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../zigbee/readme.html" class="nav-list-link">Zigbee</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../zigbee/low_power_configuration.html" class="nav-list-link">Zigbee Low Power Config</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_commissioning.html" class="nav-list-link">Zigbee Commissioning Procedure</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_greenpower.html" class="nav-list-link">Zigbee Green Power</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_project_generation.html" class="nav-list-link">Zigbee Application Project Generation</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_security_model.html" class="nav-list-link">Zigbee Network Security Models</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_combined_interface/readme.html" class="nav-list-link">Zigbee Combined Interface</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_lights/readme.html" class="nav-list-link">Zigbee Light</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_lights/readme_distributed.html" class="nav-list-link">Zigbee light Distributed Network</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_multisensor/readme.html" class="nav-list-link">Zigbee multisensor</a> </li></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../multiprotocol/readme.html" class="nav-list-link">Multiprotocol</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_basic/readme.html" class="nav-list-link">BLE+ZIGBEE Application</a> </li><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_light_prov/readme.html" class="nav-list-link">Multiprotocol Demo App</a> </li><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_light_prov/protocol.html" class="nav-list-link">Multiprotocol Demo</a> </li><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_multiSensor_prov/readme.html" class="nav-list-link">Zigbee Multi-Sensor, commissioning App</a> </li></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../docs/readme.html" class="nav-list-link">User Docs</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../zigbee/consoleCommands.html" class="nav-list-link">Serial Console Commands</a> </li><li class="nav-list-item "> <a href="../../../docs/lowpower.html" class="nav-list-link">Low Power</a> </li><li class="nav-list-item "> <a href="../../../docs/user_action.html" class="nav-list-link">User Action</a> </li><li class="nav-list-item "> <a href="../../../docs/generate_code.html" class="nav-list-link">MCC Code Generation</a> </li><li class="nav-list-item "> <a href="../../../docs/creating_new_mplabx_harmony_project.html" class="nav-list-link">Generating New MCC Harmony Code</a> </li><li class="nav-list-item "> <a href="../../../docs/pic32cx_bz2_wbz45x_sdk_setup.html" class="nav-list-link">SDK Setup</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../../release_notes.html" class="nav-list-link">Release notes</a><ul class="nav-list "><li class="nav-list-item "><a href="release_notes.html" class="nav-list-link">BLE UART Demo</a></li><li class="nav-list-item "><a href="../ble_sensor_app/release_notes.html" class="nav-list-link">BLE Sensor</a></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/chip_peripherals/uart/release_notes.html" class="nav-list-link">UART Hello World</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/legacy_adv_sleep/release_notes.html" class="nav-list-link">BLE Legacy Adv</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/ext_adv/release_notes.html" class="nav-list-link">BLE Extended Advertising</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/connection/release_notes.html" class="nav-list-link">BLE Connection (Peripheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/profiles_services/custom_service/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/connection/release_notes.html" class="nav-list-link">BLE Connection (Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/legacy_scan/release_notes.html" class="nav-list-link">BLE Legacy Scan</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/profiles_services/ml_trp_uart/release_notes.html" class="nav-list-link">BLE Multilink Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="../../building_blocks/central/scan_ext_adv/release_notes.html" class="nav-list-link">BLE Scan Extended Advertising</a></li><li class="nav-list-item "><a href="../../../multiprotocol/ble_zigbee_light_prov/release_notes.html" class="nav-list-link">Zigbee Multiprotocol Lights Prov App</a></li><li class="nav-list-item "><a href="../../../multiprotocol/ble_zigbee_multiSensor_prov/release_notes.html" class="nav-list-link">Zigbee Multi-Sensor and commissioning</a></li><li class="nav-list-item "><a href="../../../zigbee/zigbee_lights/release_notes.html" class="nav-list-link">Zigbee Combined Interface App</a></li><li class="nav-list-item "><a href="../../../zigbee/zigbee_combined_interface/release_notes.html" class="nav-list-link">Zigbee Combined Interface App</a></li><li class="nav-list-item "><a href="../../../zigbee/zigbee_multisensor/release_notes.html" class="nav-list-link">Zigbee Multi-Sensor</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony Wireless help" aria-label="Search Microchip MPLAB Harmony Wireless help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../../readme.html">Examples applications</a></li> <li class="breadcrumb-nav-list-item"><a href="../readme.html">BLE Advance Applications</a></li> <li class="breadcrumb-nav-list-item"><span>BLE UART Demo</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a></p> <h1 id="ble-uart-application-user-guide-v07"> <a href="readme.html#ble-uart-application-user-guide-v07" aria-labelledby="ble-uart-application-user-guide-v07" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> BLE UART Application User Guide (v0.7) </h1> <h2 id="revision-history"> <a href="readme.html#revision-history" aria-labelledby="revision-history" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Revision History </h2> <div class="table-wrapper"><table> <thead> <tr> <th>Revision</th> <th>Date</th> <th>Comments</th> </tr> </thead> <tbody> <tr> <td>v0.1</td> <td>2020-09-28</td> <td>Initiate this document</td> </tr> <tr> <td>v0.2</td> <td>2020-09-29</td> <td>1. Update the introduction.<br /> 2. Add Reference chapter.<br /> 3. Add some description for the supported service/profile.<br /> 4. Update the screenshot for firmware version.</td> </tr> <tr> <td>v0.3</td> <td>2020-10-14</td> <td>1. Update several screenshots.<br /> 2. Revise the LED behavior.<br /> 3. Add two chapters for UART Burst mode and Text Mode.<br /> 4. Add the Android app chapter.</td> </tr> <tr> <td>v0.4</td> <td>2020-11-30</td> <td>1. Add the user guide of the client role with a central device.</td> </tr> <tr> <td>v0.5</td> <td>2021-01-06</td> <td>Add new sections:<br /> - 1.3 LED Indication; 1.4 Button Control; 1.5 Build Option.<br /> - 3. Multi-link With Mobile Phones.<br /> - 4. Pairing &amp; Privacy. <br /> - 5. Supplement for throughput analysis.</td> </tr> <tr> <td>v0.6</td> <td>2021-03-29</td> <td>Add new sections:<br /> - 3.8. Multi-link Central Demo.<br /> - 4.3 Trusted Device Connectable Mode.<br /> - 5. Extended Adverting. <br /> - 6. Long Range. <br /> - 7.3 UART command/event format.<br /> - 7.4 Set Bluetooth Device Address.<br /></td> </tr> <tr> <td>v0.7</td> <td>2021-10-12</td> <td>1. Add new sections:<br /> - 8. Sleep mode. <br /> - 3.8.1 Reverse Loopback mode for multilink of central role. <br /> 2. Update button control and LED indication for Reverse Loopback mode.</td> </tr> </tbody> </table></div> <h2 id="table-of-contents"> <a href="readme.html#table-of-contents" aria-labelledby="table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents </h2> <!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 --> <ul> <li><a href="readme.html#ble-uart-application-user-guide-v07">BLE UART Application User Guide (v0.7)</a> <ul> <li><a href="readme.html#revision-history">Revision History</a></li> <li><a href="readme.html#table-of-contents">Table of Contents</a></li> <li><a href="readme.html#1-introduction">1. Introduction</a> <ul> <li><a href="readme.html#11-data-beacon-for-advertising">1.1. Data Beacon for Advertising</a> <ul> <li><a href="readme.html#-advertising-data">- Advertising Data</a></li> <li><a href="readme.html#-scan-response-data">- Scan Response Data</a></li> </ul> </li> <li><a href="readme.html#12-supported-service-and-profile">1.2. Supported Service and Profile</a> <ul> <li><a href="readme.html#-service">- Service</a></li> <li><a href="readme.html#-profile">- Profile</a></li> </ul> </li> <li><a href="readme.html#13-led-indication">1.3 LED Indication</a> <ul> <li><a href="readme.html#peripheral-server-role">Peripheral (Server) Role:</a></li> <li><a href="readme.html#central-client-role">Central (Client) Role:</a></li> </ul> </li> <li><a href="readme.html#14-button-control">1.4 Button Control</a></li> <li><a href="readme.html#15-build-option">1.5 Build Option</a></li> </ul> </li> <li><a href="readme.html#2-interaction-with-mbd-mobile-app">2. Interaction with MBD Mobile App</a> <ul> <li><a href="readme.html#21-work-with-ios-mbd-app">2.1. Work with iOS MBD App</a> <ul> <li><a href="readme.html#-how-to-scan-and-connect-to-the-device">- How to Scan and Connect to the Device</a></li> <li><a href="readme.html#-firmware-version">- Firmware Version</a></li> <li><a href="readme.html#-select-transparent-profile">- Select Transparent Profile</a></li> <li><a href="readme.html#-demo-modes">- Demo Modes</a> <ul> <li><a href="readme.html#a-burst-modes">A. Burst Modes</a> <ul> <li><a href="readme.html#1-checksum-mode">1. Checksum Mode</a></li> <li><a href="readme.html#2-fixed-pattern-mode">2. Fixed Pattern Mode</a></li> <li><a href="readme.html#3-loopback-mode">3. Loopback Mode</a></li> <li><a href="readme.html#4-uart-mode">4. UART Mode</a></li> </ul> </li> <li><a href="readme.html#b-text-mode">B. Text Mode</a></li> </ul> </li> </ul> </li> <li><a href="readme.html#22-work-with-android-mbd-app">2.2. Work with Android MBD App</a> <ul> <li><a href="readme.html#-how-to-scan-and-connect-to-the-device">- How to Scan and Connect to the Device</a></li> <li><a href="readme.html#-firmware-version">- Firmware Version</a></li> <li><a href="readme.html#-select-transparent-profile">- Select Transparent Profile</a></li> <li><a href="readme.html#-demo-modes">- Demo Modes</a> <ul> <li><a href="readme.html#a-burst-modes">A. Burst Modes</a> <ul> <li><a href="readme.html#1-checksum-mode">1. Checksum Mode</a></li> <li><a href="readme.html#2-fixed-pattern-mode">2. Fixed Pattern Mode</a></li> <li><a href="readme.html#3-loopback-mode">3. Loopback Mode</a></li> <li><a href="readme.html#4-uart-mode">4. UART Mode</a></li> </ul> </li> <li><a href="readme.html#b-text-mode">B. Text Mode</a></li> </ul> </li> </ul> </li> <li><a href="readme.html#23-multi-link-demo-with-mobile-phones">2.3. Multi-link Demo With Mobile Phones</a> <ul> <li><a href="readme.html#how-to-establish-the-second-le-link-with-mobile-phone">How to Establish the Second LE Link With Mobile Phone</a></li> <li><a href="readme.html#demo-mode">Demo Mode</a></li> </ul> </li> </ul> </li> <li><a href="readme.html#3-interaction-of-both-pic32cx-bz-devices">3. Interaction of both PIC32CX-BZ Devices</a> <ul> <li><a href="readme.html#31-supported-profile">3.1. Supported Profile</a></li> <li><a href="readme.html#32-the-topology-of-pic32cx-bz-to-pic32cx-bz">3.2. The Topology of PIC32CX-BZ to PIC32CX-BZ:</a></li> <li><a href="readme.html#33-role-switch-between-a-central-device-and-a-peripheral-device">3.3. Role Switch between a Central Device and a Peripheral Device</a></li> <li><a href="readme.html#34-ble-link-creation">3.4. BLE Link Creation</a></li> <li><a href="readme.html#35-data-exchange-modes">3.5. Data Exchange Modes</a></li> <li><a href="readme.html#36-led-indication">3.6. LED Indication</a></li> <li><a href="readme.html#37-data-exchange-demo-procedures">3.7. Data Exchange Demo Procedures</a></li> <li><a href="readme.html#38-multi-link-for-central-role-demo">3.8. Multi-link For Central Role Demo</a> <ul> <li><a href="readme.html#381-reverse-loopback-modes">3.8.1 Reverse Loopback Modes</a></li> </ul> </li> </ul> </li> <li><a href="readme.html#4-security-and-privacy">4. Security and Privacy</a> <ul> <li><a href="readme.html#41-security">4.1 Security</a></li> <li><a href="readme.html#42-privacy">4.2 Privacy</a></li> <li><a href="readme.html#43-trusted-device-connectable-mode">4.3 Trusted Device Connectable Mode</a></li> </ul> </li> <li><a href="readme.html#5-extended-adverting">5. Extended Adverting</a></li> <li><a href="readme.html#6-long-range">6. Long Range</a> <ul> <li><a href="readme.html#61-introduction">6.1 Introduction</a></li> <li><a href="readme.html#62-data-exchange-demo-procedures">6.2 Data Exchange Demo Procedures</a> <ul> <li><a href="readme.html#621-the-mobile-phone-vs-the-pic32cx-bz-device">6.2.1 The Mobile Phone V.S The PIC32CX-BZ Device</a></li> <li><a href="readme.html#622-the-pic32cx-bz-devices">6.2.2 The PIC32CX-BZ Devices</a></li> <li><a href="readme.html#623-the-link-loss-distance-measurement-and-the-maximum-link-distatnce-measurement">6.2.3 The Link Loss Distance Measurement and The Maximum Link Distatnce Measurement</a></li> </ul> </li> <li><a href="readme.html#63-notification">6.3 Notification</a></li> </ul> </li> <li><a href="readme.html#7-supplement">7. Supplement</a> <ul> <li><a href="readme.html#71-throughput-filed-test-report">7.1. Throughput Filed Test Report</a> <ul> <li><a href="readme.html#-with-mobile-phones">-With Mobile Phones</a></li> <li><a href="readme.html#-pic32cx-bz-vs-pic32cx-bz">-PIC32CX-BZ v.s PIC32CX-BZ</a></li> </ul> </li> <li><a href="readme.html#72-how-to-achieve-maximum-throughput-with-smart-phones">7.2. How to Achieve Maximum Throughput with Smart Phones</a> <ul> <li><a href="readme.html#operation-type">Operation Type</a></li> <li><a href="readme.html#connection-interval">Connection Interval</a></li> <li><a href="readme.html#number-of-packets-transmitted-within-a-connection-event">Number of Packets Transmitted Within a Connection Event</a></li> <li><a href="readme.html#data-size-of-each-packet">Data Size of Each Packet</a></li> <li><a href="readme.html#limitation-of-uart">Limitation of UART</a></li> <li><a href="readme.html#note">Note:</a></li> </ul> </li> <li><a href="readme.html#73-uart-commandevent-format">7.3. UART Command/Event Format</a></li> <li><a href="readme.html#74-set-bluetooth-device-address">7.4. Set Bluetooth Device Address</a></li> </ul> </li> <li><a href="readme.html#8-sleep-mode">8. Sleep Mode</a> <ul> <li><a href="readme.html#81-how-to-use-MCC-to-configure-sleep-mode">8.1. How to use MPLAB® Code Configurator (MCC) to Configure Sleep Mode</a></li> <li><a href="readme.html#82-the-scope-of-sleep-mode">8.2. The Scope of Sleep Mode</a></li> </ul> </li> <li><a href="readme.html#reference">Reference</a></li> </ul> </li> </ul> <!-- /TOC --> <h2 id="1-introduction"> <a href="readme.html#1-introduction" aria-labelledby="1-introduction" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Introduction </h2> <p>The purpose of this document is to illustrate the user guide of the BLE UART Application for PIC32CX-BZ. BLE UART Application is designed to demonstrate several functionalities including:</p> <ol> <li>Connection with mobile phone via BLE</li> <li>Data transmission between PIC32CX-BZ and mobile phone via BLE and throughput evaluation.</li> <li>Data transmission between PIC32CX-BZ and mobile phone via BLE; data transmission between PIC32CX-BZ and a host device (such as PC) via UART and throughput evaluation. In order to do the data comparison in the receiver side, the fixed data pattern shall be provided in the sender side.</li> <li>Data transmission for the UART mode or the loopback mode via BLE between PIC32CX-BZ devices which are both the client role of a central device and the server role of a peripheral device.</li> <li>Data exchange between PIC32CX-BZ and mobile phone via BLE long range or Data exchange between PIC32CX-BZ devices via BLE long range and the link loss distance evaluation for long range or maximum link distatnce evaluation for long range.<br /></li> </ol> <h3 id="11-data-beacon-for-advertising"> <a href="readme.html#11-data-beacon-for-advertising" aria-labelledby="11-data-beacon-for-advertising" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.1. Data Beacon for Advertising </h3> <h4 id="--advertising-data"> <a href="readme.html#--advertising-data" aria-labelledby="--advertising-data" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Advertising Data </h4> <p>The Service Data Format is utilized in advertising data. The data format is shown as below:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">ADV Length</th> <th style="text-align: center">ADV Type</th> <th style="text-align: center">Service UUID</th> <th style="text-align: center">Additional data</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">Length</td> <td style="text-align: center">1 Byte</td> <td style="text-align: center">1 Byte</td> <td style="text-align: center">2 Bytes</td> <td style="text-align: center">Up to 27 bytes</td> </tr> <tr> <td style="text-align: center">Value</td> <td style="text-align: center">0xXX</td> <td style="text-align: center">0x16</td> <td style="text-align: center">0xFEDA*</td> <td style="text-align: center">0xXX…</td> </tr> </tbody> </table></div> <p>*Note: 0xFEDA is a 16-bit Service UUID which is purchased by Microchip from Bluetooth SIG.</p> <h4 id="--scan-response-data"> <a href="readme.html#--scan-response-data" aria-labelledby="--scan-response-data" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Scan Response Data </h4> <p>The device name is put in the scan response. And the device name is set as “BLE_UART_XXXX”. (XXXX means the last two bytes of the device address.)<br /></p> <h3 id="12-supported-service-and-profile"> <a href="readme.html#12-supported-service-and-profile" aria-labelledby="12-supported-service-and-profile" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.2. Supported Service and Profile </h3> <p>The supported service and profile are listed in the below section.</p> <h4 id="--service"> <a href="readme.html#--service" aria-labelledby="--service" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Service </h4> <ol> <li>Transparent Service: MCHP proprietary service, see Reference [1] for the detail.</li> <li>Transparent Credit Based Service: MCHP proprietary service, see Reference [2] for the detail.</li> <li>Device Information Service: Bluetooth SIG standard service, see Reference [3] for the detail.</li> </ol> <h4 id="--profile"> <a href="readme.html#--profile" aria-labelledby="--profile" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Profile </h4> <ol> <li>Transparent Profile (TRP): MCHP proprietary profile, see Reference [4] for the detail.</li> <li>Transparent Credit Based Profile (TRCBP): MCHP proprietary profile, see Reference [5] for the detail.<br /></li> </ol> <h3 id="13-led-indication"> <a href="readme.html#13-led-indication" aria-labelledby="13-led-indication" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.3 LED Indication </h3> <p>The LED indication is defined as below based on the different role and state:</p> <h4 id="peripheral-server-role"> <a href="readme.html#peripheral-server-role" aria-labelledby="peripheral-server-role" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Peripheral (Server) Role: </h4> <ol> <li>Advertising State (No LE link existed): Flash Green LED one time every 500 ms.</li> <li>Connected with one or multiple peer devices: Green LED is always on.</li> <li>Advertising State with at least 1 LE link has been established: Flash Green LED one time every 500 ms.</li> </ol> <h4 id="central-client-role"> <a href="readme.html#central-client-role" aria-labelledby="central-client-role" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Central (Client) Role: </h4> <ol> <li>Scanning State: Flash Red LED one time every 500 ms.</li> <li>Connected with one or multiple peer devices: Red LED is always on.</li> <li>UART Demo Mode is selected: Red LED is always on.</li> <li>Loopback Demo Mode is selected: Flash Red LED twice every 3 seconds.</li> <li>Scanning State with at least 1 LE link has been established: Flash Red LED one time every 500 ms.<br /></li> </ol> <p>Note: Idle State: All LEDs are off.<br /></p> <h3 id="14-button-control"> <a href="readme.html#14-button-control" aria-labelledby="14-button-control" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.4 Button Control </h3> <p>The user button is used to control the device behavior.<br /> <img src="assets/markdown-img-paste-20210104152451667.png" alt="67" /><br /> The button control is defined as below table based on the different state:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Current State <br />(LED Status)</th> <th style="text-align: center">Short Press<br />(Action/Next State)</th> <th style="text-align: center">Long Press<br />(Action/Next State)</th> <th style="text-align: center">Double Press<br />(Action/Next State)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">Adverting State<br />(Flash Green LED one time every 500 ms)</td> <td style="text-align: center">Scanning/Scanning State</td> <td style="text-align: center">Disable Advertising/Idle State</td> <td style="text-align: center"> </td> </tr> <tr> <td style="text-align: center">Scanning State<br />(Flash Red LED one time every 500 ms)</td> <td style="text-align: center">Advertising/Advertising State</td> <td style="text-align: center">Disable Scan/Idle State</td> <td style="text-align: center"> </td> </tr> <tr> <td style="text-align: center">Connected as Peripheral role with 1 device<br />(Green LED is always on)</td> <td style="text-align: center">Advertising/Connected State with Advertising</td> <td style="text-align: center">Terminate the link/Advertising State</td> <td style="text-align: center"> </td> </tr> <tr> <td style="text-align: center">Connected as Central role with 1 device<br />(Red LED is always on)</td> <td style="text-align: center">Switch Demo mode between UART mode and Loopback mode/Connected Sate</td> <td style="text-align: center">Scanning/Connected State with Scanning</td> <td style="text-align: center">Start Reverse Loopback mode/reverse loopback mode</td> </tr> <tr> <td style="text-align: center">Connected as Peripheral role with 1+ devices<br />(Green LED is always on)</td> <td style="text-align: center">1. Max connected devices approached: No Action/Connected State.<br /> 2. Max connected devices is not approached: Advertising/Connected State with Advertising.<br /> Note: BLE UART v0.7.2 can achieve 4 devices multi-link.</td> <td style="text-align: center">Terminate the link of the first connected device/Connected State.</td> <td style="text-align: center"> </td> </tr> <tr> <td style="text-align: center">Connected as Central role with 1+ devices<br />(Red LED is always on)</td> <td style="text-align: center">Switch Demo mode between UART mode and Loopback mode/Connected Sate</td> <td style="text-align: center">1. Max connected devices approached: No Action/Connected State.<br /> 2. Max connected devices is not approached: Scanning/Connected State with Scanning.<br /> Note: BLE UART v0.7.2 can achieve 6 devices multi-link.</td> <td style="text-align: center">Start Reverse Loopback mode/reverse loopback mode</td> </tr> <tr> <td style="text-align: center">Central role multi-link for reverse loopback mode <br />(Flash Red LED one time every 300 ms)</td> <td style="text-align: center">No Action/reverse loopback mode</td> <td style="text-align: center">No Action/reverse loopback mode</td> <td style="text-align: center">Start Reverse Loopback mode/reverse loopback mode</td> </tr> <tr> <td style="text-align: center">Idle State<br />(All LEDs are off)</td> <td style="text-align: center">Advertising/Advertising State</td> <td style="text-align: center">No Action/Idle State</td> <td style="text-align: center">No Action/Idle State</td> </tr> </tbody> </table></div> <p>Note: The user button can’t work correctly with Curiosity board hardware version WBZ451 v1. Please use version R2.0 instead.<br /></p> <h3 id="15-build-option"> <a href="readme.html#15-build-option" aria-labelledby="15-build-option" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1.5 Build Option </h3> <p>The features supported in BLE UART could be activated/deactivated by enable/disable the corresponding define in app.h:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Feature</th> <th style="text-align: center">Define</th> <th style="text-align: center">Default Setting</th> <th style="text-align: center">Note</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">Transparent Profile Client Role</td> <td style="text-align: center">APP_TRPC_ENABLE</td> <td style="text-align: center">Enable</td> <td style="text-align: center">Used for doing data transmission between two PIC32CX-BZ devices. Refer to section 3.</td> </tr> <tr> <td style="text-align: center">Multi-link with mobile phones</td> <td style="text-align: center">APP_BLE_MULTI_LINK_ENABLE</td> <td style="text-align: center">Enable</td> <td style="text-align: center">Refer to section 3.</td> </tr> <tr> <td style="text-align: center">Pairing</td> <td style="text-align: center">APP_PAIRING_ENABLE</td> <td style="text-align: center">Disable</td> <td style="text-align: center">Refer to section 4.</td> </tr> <tr> <td style="text-align: center">Privacy</td> <td style="text-align: center">APP_PRIVACY_ENABLE</td> <td style="text-align: center">Disable</td> <td style="text-align: center">Refer to section 4.</td> </tr> <tr> <td style="text-align: center">Extended Adverting</td> <td style="text-align: center">APP_EXT_ADV_ENABLE</td> <td style="text-align: center">Enable</td> <td style="text-align: center">Refer to section 5.</td> </tr> <tr> <td style="text-align: center">UART Commnad/Event</td> <td style="text-align: center">APP_UART_CMD_SET_ENABLE</td> <td style="text-align: center">Disable</td> <td style="text-align: center">Refer to section 7.3.</td> </tr> <tr> <td style="text-align: center">Long Range<br />(S=8)</td> <td style="text-align: center">APP_BLE_CODED_PHY_ENABLE</td> <td style="text-align: center">Disable</td> <td style="text-align: center">Refer to section 6</td> </tr> <tr> <td style="text-align: center">Long Range<br />(S=2)</td> <td style="text-align: center">APP_BLE_CODED_PHY_ENABLE, APP_BLE_CODED_S2_ENABLE</td> <td style="text-align: center">Disable</td> <td style="text-align: center">Refer to section 6</td> </tr> <tr> <td style="text-align: center">Sleep Modes</td> <td style="text-align: center">ENABLE_SLEEP_MODE</td> <td style="text-align: center">Disable</td> <td style="text-align: center">Refer to section 8</td> </tr> </tbody> </table></div> <h2 id="2-interaction-with-mbd-mobile-app"> <a href="readme.html#2-interaction-with-mbd-mobile-app" aria-labelledby="2-interaction-with-mbd-mobile-app" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Interaction with MBD Mobile App </h2> <h3 id="21-work-with-ios-mbd-app"> <a href="readme.html#21-work-with-ios-mbd-app" aria-labelledby="21-work-with-ios-mbd-app" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.1. Work with iOS MBD App </h3> <h4 id="--how-to-scan-and-connect-to-the-device"> <a href="readme.html#--how-to-scan-and-connect-to-the-device" aria-labelledby="--how-to-scan-and-connect-to-the-device" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - How to Scan and Connect to the Device </h4> <p>The steps of scan and connect to the device via mobile app are described as below:</p> <ol> <li>Select BLE UART:<br /> <img src="assets/markdown-img-paste-20201014175114829.png" alt="01" /></li> <li>Select “Coming Soon” <br /> <img src="assets/markdown-img-paste-20201014175222877.png" alt="02" /></li> <li>Tap “BLE_UART_XXXX” (XXXX means the last two bytes of the device address) to issue the connection request:<br /> <img src="assets/markdown-img-paste-20201014175240744.png" alt="03" /></li> </ol> <h4 id="--firmware-version"> <a href="readme.html#--firmware-version" aria-labelledby="--firmware-version" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Firmware Version </h4> <p>After LE is connected, press the setting button:<br /> <img src="assets/markdown-img-paste-20201014175317870.png" alt="04" /></p> <p>The firmware version is shown on the below screenshot:<br /> <img src="assets/markdown-img-paste-20201014175335312.png" alt="05" /></p> <h4 id="--select-transparent-profile"> <a href="readme.html#--select-transparent-profile" aria-labelledby="--select-transparent-profile" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Select Transparent Profile </h4> <p>There are two profiles are supported for the data transmission:</p> <ol> <li>Legacy Transparent Profile (TRP)</li> <li>Transparent Credit Based Profile (TRCBP) Press the setting button to enter the setting page, then select the profile type: (Use TRP by default setting.)<br /> <img src="assets/markdown-img-paste-20201014175404994.png" alt="06" /></li> </ol> <h4 id="--demo-modes"> <a href="readme.html#--demo-modes" aria-labelledby="--demo-modes" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Demo Modes </h4> <p>There are two modes are supported in UART mode: Burst Mode and Text Mode.<br /> Burst Mode is designed for the throughput evaluation via massive data transportation.<br /> Text Mode is designed for the simple typing.<br /> The following chapter describes more detail for these two modes.</p> <h5 id="a-burst-modes"> <a href="readme.html#a-burst-modes" aria-labelledby="a-burst-modes" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A. Burst Modes </h5> <p>There are four demo modes supported:</p> <ol> <li>Checksum mode: Mobile app to the device (Uni-direction)</li> <li>Fixed pattern mode: Device to Mobile app (Uni-direction)</li> <li>Loopback mode: Mobile app → Device → Mobile app (Bi-direction)</li> <li>UART mode: Mobile app → Device → UART output to PC ; UART input from PC → Device → Mobile app (Bi-direction)</li> </ol> <h6 id="1-checksum-mode"> <a href="readme.html#1-checksum-mode" aria-labelledby="1-checksum-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Checksum Mode </h6> <ul> <li>Send the data from Mobile app to device. (Uni-direction)</li> <li>Purpose: Demonstrate the downlink (mobile app to ) throughput.</li> <li>UI Operation: <ol> <li>Select “Checksum” mode on the mobile app.<br /> <img src="assets/markdown-img-paste-20201014175447763.png" alt="07" /> <img src="assets/markdown-img-paste-20201014175511534.png" alt="08" /> <br /></li> <li>Select file:<br /> <img src="assets/markdown-img-paste-20201014175541945.png" alt="09" /> <br /></li> <li>Press “START” to start transmitting data.</li> <li>After data transmission finished, the device will send the checksum (one byte) to mobile app. Then the mobile app will compare the checksum sent from the device with the checksum calculated by itself.</li> <li>Mobile app shows if the data transmission is successful or not and calculate the throughput.<br /> <img src="assets/markdown-img-paste-20210113173847386.png" alt="10" /> <br /></li> </ol> </li> </ul> <h6 id="2-fixed-pattern-mode"> <a href="readme.html#2-fixed-pattern-mode" aria-labelledby="2-fixed-pattern-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Fixed Pattern Mode </h6> <ul> <li>Send the incremental counter data from device to mobile app. (Uni-direction)</li> <li>Purpose: Demonstrate the uplink (PIC32CX-BZ to mobile app) throughput.</li> <li>UI Operation: <ol> <li>Select “Fixed pattern” mode on mobile app.<br /> <img src="assets/markdown-img-paste-20201014175808849.png" alt="11" /> <br /></li> <li>No need to select file from mobile app. The file size sent from device to mobile app is determined by the device (500 Kbytes).</li> <li>Press “START” to start transmitting data.</li> <li>Mobile app will examine if the received data is incremental. After data transmission finished, the device will notify the mobile app for the last number value. Then the mobile app will examine the last number value.</li> <li>Mobile app shows if the data transmission is successful or not and calculate the throughput.<br /> <img src="assets/markdown-img-paste-2021011317411239.png" alt="12" /> <br /></li> </ol> </li> </ul> <h6 id="3-loopback-mode"> <a href="readme.html#3-loopback-mode" aria-labelledby="3-loopback-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Loopback Mode </h6> <ul> <li>Send the data from Mobile app to device then it will be loopback to Mobile app. (Bi-direction)</li> <li>Purpose: Demonstrate the bi-direction throughput.</li> <li>UI Operation: <ol> <li>Select “loopback” mode on mobile app.<br /> <img src="assets/markdown-img-paste-20201014175939136.png" alt="13" /> <br /></li> <li>Select file:<br /> <img src="assets/markdown-img-paste-20201014175954436.png" alt="14" /> <br /></li> <li>Press “START” to start transmitting data.</li> <li>Mobile app examines if the loopback data is correct or missed.</li> <li>Mobile app shows if the data transmission is successful or not and calculate the throughput.<br /> <img src="assets/markdown-img-paste-20210113174424597.png" alt="15" /> <br /></li> </ol> </li> </ul> <h6 id="4-uart-mode"> <a href="readme.html#4-uart-mode" aria-labelledby="4-uart-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. UART Mode </h6> <ul> <li> <p>Data flow: Mobile app → Device → PC (via UART);  PC (via UART) → Device → Mobile app <br /> <img src="assets/markdown-img-paste-2020101418011464.png" alt="16" /></p> </li> <li>Purpose: Demonstrate the bi-direction data exchange with UART.</li> <li> <p>A proprietary PC utility tool called “MCHP BLE UART Test Tool” is required to do the massive data exchange (up to 500kBytes) between the device and PC via UART and compare/investigate the received data after the data exchange.</p> </li> <li>UI Operation: <ol> <li>PC side:<br /> <ul> <li> <p>Set COM port, Baudrate and enable H/W flow control then press “Connect”:<br /> <img src="assets/markdown-img-paste-20201014180427726.png" alt="17" /><br /></p> </li> <li> <p>Load File to choose the target test pattern. Then the user can check both “Compare Enable” and “Start Compare when Tx/Rx End” for <strong>Bi-direction</strong> UART test as below screenshot:<br /> <img src="assets/markdown-img-paste-20201014180647929.png" alt="18" /><br /></p> </li> <li> <p>Or only check “Compare Enable” for <strong>Uni-direction</strong> UART test:<br /> <img src="assets/markdown-img-paste-2020101418073414.png" alt="19" /><br /></p> </li> </ul> </li> <li>Mobile app side:<br /> <ul> <li> <p>Select “UART” mode on mobile app.<br /> <img src="assets/markdown-img-paste-20201014180814859.png" alt="20" /><br /></p> </li> <li> <p>Select file:<br /> <img src="assets/markdown-img-paste-20201014180849918.png" alt="21" /><br /></p> </li> <li> <p>Press “START” to start transmitting data from mobile app.<br /></p> </li> </ul> </li> <li>PC side:<br /> <ul> <li> <p>Press “Tx Start” to start transmitting data from PC tool.<br /> <img src="assets/markdown-img-paste-20201014180934987.png" alt="22" /><br /></p> </li> <li> <p>PC Tool will show how many bytes it receives and will show the Compare Result after all the data has been transmitted:<br /> <img src="assets/markdown-img-paste-20201014181005728.png" alt="23" /><br /></p> </li> </ul> </li> <li>Mobile app side: After all the data sent from PC are received, mobile app shows if the data comparison is PASS or not.<br /> <img src="assets/markdown-img-paste-2021011317452771.png" alt="24" /><br /></li> </ol> </li> </ul> <h5 id="b-text-mode"> <a href="readme.html#b-text-mode" aria-labelledby="b-text-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> B. Text Mode </h5> <p>In Text mode, a generic terminal tool such as “Putty” could be utilized for the simple typing.</p> <ul> <li>UI Operation: <ol> <li>PC side (Use Putty as an example):<br /> <ul> <li>Set COM port, Baudrate (921600 kbps) and enable H/W flow control:<br /> <img src="assets/markdown-img-paste-2020101418114224.png" alt="25" /> <br /></li> </ul> </li> <li>Mobile app side:<br /> <ul> <li> <p>Select “Text Mode” on mobile app.<br /> <img src="assets/markdown-img-paste-20201014181156622.png" alt="26" /><br /></p> </li> <li> <p>Type the string then press send:<br /> <img src="assets/markdown-img-paste-20201014181216665.png" alt="27" /><br /></p> </li> </ul> </li> <li>PC side:<br /> <ul> <li> <p>The string sent from the mobile app is shown on the screen.<br /> <img src="assets/markdown-img-paste-20201014181236793.png" alt="28" /><br /></p> </li> <li> <p>Enter string on Putty:<br /> <img src="assets/markdown-img-paste-20201014181249392.png" alt="29" /><br /></p> </li> </ul> </li> <li>Mobile app side:<br /> <ul> <li>The string sent from the PC is shown on the mobile app.<br /> <img src="assets/markdown-img-paste-20201014181314251.png" alt="30" /><br /><br /></li> </ul> </li> </ol> </li> </ul> <h3 id="22-work-with-android-mbd-app"> <a href="readme.html#22-work-with-android-mbd-app" aria-labelledby="22-work-with-android-mbd-app" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.2. Work with Android MBD App </h3> <h4 id="--how-to-scan-and-connect-to-the-device-1"> <a href="readme.html#--how-to-scan-and-connect-to-the-device-1" aria-labelledby="--how-to-scan-and-connect-to-the-device-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - How to Scan and Connect to the Device </h4> <p>The steps of scan and connect to the device via mobile app are described as below:</p> <ol> <li> <p>Select BLE UART -&gt; Coming Soon:<br /> <img src="assets/markdown-img-paste-2021011318313400.png" alt="31" /> <img src="assets/markdown-img-paste-20210113183106610.png" alt="31" /></p> </li> <li> <p>Tap “BLE_UART_XXXX” (XXXX means the last two bytes of the device address) to issue the connection request:<br /> <img src="assets/markdown-img-paste-20201014183524226.png" alt="33" /></p> </li> </ol> <h4 id="--firmware-version-1"> <a href="readme.html#--firmware-version-1" aria-labelledby="--firmware-version-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Firmware Version </h4> <p>After LE is connected, press the setting button:<br /> <img src="assets/markdown-img-paste-20201014183638669.png" alt="34" /></p> <p>The firmware version is shown on the below screenshot:<br /> <img src="assets/markdown-img-paste-20201014183652285.png" alt="35" /></p> <h4 id="--select-transparent-profile-1"> <a href="readme.html#--select-transparent-profile-1" aria-labelledby="--select-transparent-profile-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Select Transparent Profile </h4> <p>There are two profiles are supported for the data transmission:</p> <ol> <li>Legacy Transparent Profile (TRP)</li> <li>Transparent Credit Based Profile (TRCBP) Press the setting button to enter the setting page, then select the profile type: (Use TRP by default setting.)<br /> <img src="assets/markdown-img-paste-2020101418372550.png" alt="36" /></li> </ol> <h4 id="--demo-modes-1"> <a href="readme.html#--demo-modes-1" aria-labelledby="--demo-modes-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> - Demo Modes </h4> <p>There are two modes are supported in UART mode: Burst Mode and Text Mode.<br /> Burst Mode is designed for the throughput evaluation via massive data transportation.<br /> Text Mode is designed for the simple typing.<br /> The following chapter describes more detail for these two modes.</p> <h5 id="a-burst-modes-1"> <a href="readme.html#a-burst-modes-1" aria-labelledby="a-burst-modes-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A. Burst Modes </h5> <p>There are four demo modes supported:</p> <ol> <li>Checksum mode: Mobile app to the device (Uni-direction)</li> <li>Fixed pattern mode: Device to Mobile app (Uni-direction)</li> <li>Loopback mode: Mobile app → Device → Mobile app (Bi-direction)</li> <li>UART mode: Mobile app → Device → UART output to PC ; UART input from PC → Device → Mobile app (Bi-direction)</li> </ol> <h6 id="1-checksum-mode-1"> <a href="readme.html#1-checksum-mode-1" aria-labelledby="1-checksum-mode-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Checksum Mode </h6> <ul> <li>Send the data from Mobile app to device. (Uni-direction)</li> <li>Purpose: Demonstrate the downlink (mobile app to PIC32CX-BZ) throughput.</li> <li>UI Operation: <ol> <li> <p>Select “Checksum” mode on the mobile app.<br /> <img src="assets/markdown-img-paste-20201014183747513.png" alt="37" /> <img src="assets/markdown-img-paste-20201014183807396.png" alt="38" /></p> </li> <li> <p>Select file:<br /> <img src="assets/markdown-img-paste-20201014183823868.png" alt="39" /></p> </li> <li>Press “START” to start transmitting data.</li> <li>After data transmission finished, the device will send the checksum (one byte) to mobile app. Then the mobile app will compare the checksum sent from the device with the checksum calculated by itself.</li> <li>Mobile app shows if the data transmission is successful or not and calculate the throughput.<br /> <img src="assets/markdown-img-paste-20210113182720241.png" alt="40" /> <br /></li> </ol> </li> </ul> <h6 id="2-fixed-pattern-mode-1"> <a href="readme.html#2-fixed-pattern-mode-1" aria-labelledby="2-fixed-pattern-mode-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Fixed Pattern Mode </h6> <ul> <li>Send the incremental counter data from device to mobile app. (Uni-direction)</li> <li>Purpose: Demonstrate the uplink (PIC32CX-BZ to mobile app) throughput.</li> <li>UI Operation: <ol> <li> <p>Select “Fixed pattern” mode on mobile app.<br /> <img src="assets/markdown-img-paste-20201014184014802.png" alt="41" /></p> </li> <li>No need to select file from mobile app. The file size sent from device to mobile app is determined by the device (500 Kbytes).</li> <li>Press “START” to start transmitting data.</li> <li>Mobile app will examine if the received data is incremental. After data transmission finished, the device will notify the mobile app for the last number value. Then the mobile app will examine the last number value.</li> <li>Mobile app shows if the data transmission is successful or not and calculate the throughput.<br /> <img src="assets/markdown-img-paste-2021011318330164.png" alt="42" /> <br /></li> </ol> </li> </ul> <h6 id="3-loopback-mode-1"> <a href="readme.html#3-loopback-mode-1" aria-labelledby="3-loopback-mode-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Loopback Mode </h6> <ul> <li>Send the data from Mobile app to device then it will be loopback to Mobile app. (Bi-direction)</li> <li>Purpose: Demonstrate the bi-direction throughput.</li> <li>UI Operation: <ol> <li> <p>Select “loopback” mode on mobile app.<br /> <img src="assets/markdown-img-paste-20201014184126787.png" alt="43" /></p> </li> <li> <p>Select file:<br /> <img src="assets/markdown-img-paste-20201014184137431.png" alt="44" /></p> </li> <li>Press “START” to start transmitting data.</li> <li>Mobile app examines if the loopback data is correct or missed.</li> <li>Mobile app shows if the data transmission is successful or not and calculate the throughput.<br /> <img src="assets/markdown-img-paste-20210113183355583.png" alt="45" /> <br /></li> </ol> </li> </ul> <h6 id="4-uart-mode-1"> <a href="readme.html#4-uart-mode-1" aria-labelledby="4-uart-mode-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. UART Mode </h6> <ul> <li> <p>Data flow: Mobile app → Device → PC (via UART);  PC (via UART) → Device → Mobile app <br /> <img src="assets/markdown-img-paste-2020101418011464.png" alt="46" /></p> </li> <li>Purpose: Demonstrate the bi-direction data exchange with UART.</li> <li>There are two modes are supported in UART mode: Burst Mode and Text Mode.<br /> Burst Mode is designed for the throughput evaluation via massive data transportation.<br /> Text Mode is designed for the simple typing. The following chapter describes more detail for these two modes.</li> <li> <p>A proprietary PC utility tool called “MCHP BLE UART Test Tool” is required to do the massive data exchange (up to 500kBytes) between the device and PC via UART and compare/investigate the received data after the data exchange.</p> </li> <li>UI Operation: <ol> <li>PC side: (The same with iOS version)<br /> <ul> <li> <p>Set COM port, Baudrate and enable H/W flow control then press “Connect”:<br /> <img src="assets/markdown-img-paste-20201014180427726.png" alt="47" /><br /></p> </li> <li> <p>Load File to choose the target test pattern. Then the user can check both “Compare Enable” and “Start Compare when Tx/Rx End” for <strong>Bi-direction</strong> UART test as below screenshot:<br /> <img src="assets/markdown-img-paste-20201014180647929.png" alt="48" /><br /></p> </li> <li> <p>Or only check “Compare Enable” for <strong>Uni-direction</strong> UART test :<br /> <img src="assets/markdown-img-paste-2020101418073414.png" alt="49" /><br /></p> </li> </ul> </li> <li>Mobile app side:<br /> <ul> <li> <p>Select “UART” mode on mobile app.<br /> <img src="assets/markdown-img-paste-20201014184434228.png" alt="50" /><br /></p> </li> <li> <p>Select file:<br /> <img src="assets/markdown-img-paste-20201014184449486.png" alt="51" /><br /></p> </li> <li> <p>Press “START” to start transmitting data from mobile app.<br /><br /></p> </li> </ul> </li> <li>PC side:<br /> <ul> <li> <p>Press “Tx Start” to start transmitting data from PC tool.<br /> <img src="assets/markdown-img-paste-20201014180934987.png" alt="52" /><br /></p> </li> <li> <p>PC Tool will show how many bytes it receives and will show the Compare Result after all the data has been transmitted:<br /> <img src="assets/markdown-img-paste-20201014181005728.png" alt="53" /><br /></p> </li> </ul> </li> <li>Mobile app side: After all the data sent from PC are received, mobile app shows if the data comparison is PASS or not.<br /> <img src="assets/markdown-img-paste-20210113183615574.png" alt="54" /><br /></li> </ol> </li> </ul> <h5 id="b-text-mode-1"> <a href="readme.html#b-text-mode-1" aria-labelledby="b-text-mode-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> B. Text Mode </h5> <p>In Text mode, a generic terminal tool such as “Putty” could be utilized for the simple typing.</p> <ul> <li>UI Operation: <ol> <li> <p>PC side (Use Putty as an example):<br /> Set COM port, Baudrate (921600 kbps) and enable H/W flow control:<br /> <img src="assets/markdown-img-paste-2020101418114224.png" alt="55" /><br /></p> </li> <li>Mobile app side:<br /> <ul> <li>Select “Text Mode” on mobile app and type the string then press send:<br /> <img src="assets/markdown-img-paste-20201014184621324.png" alt="57" /><br /></li> </ul> </li> <li>PC side:<br /> <ul> <li> <p>The string sent from the mobile app is shown on the screen.<br /> <img src="assets/markdown-img-paste-20201014181236793.png" alt="58" /><br /></p> </li> <li> <p>Enter string on Putty:<br /> <img src="assets/markdown-img-paste-20201014181249392.png" alt="59" /><br /></p> </li> </ul> </li> <li>Mobile app side: The string sent from the PC is shown on the mobile app.</li> </ol> </li> </ul> <h3 id="23-multi-link-demo-with-mobile-phones"> <a href="readme.html#23-multi-link-demo-with-mobile-phones" aria-labelledby="23-multi-link-demo-with-mobile-phones" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.3. Multi-link Demo With Mobile Phones </h3> <ul> <li>BLE UART supports to connect with two mobile phones at the same time.<br /> <img src="assets/markdown-img-paste-20210104163205905.png" alt="68" /><br /></li> <li>Two Transparent methods supported: <ul> <li>Transparent Profile (TRP)</li> <li>Transparent Credit Based Profile (TRCBP) <br /></li> </ul> </li> </ul> <h4 id="how-to-establish-the-second-le-link-with-mobile-phone"> <a href="readme.html#how-to-establish-the-second-le-link-with-mobile-phone" aria-labelledby="how-to-establish-the-second-le-link-with-mobile-phone" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How to Establish the Second LE Link With Mobile Phone </h4> <ol> <li>Once the first mobile phone is connected with PIC32CX-BZ, short press the user button to enable advertising again.</li> <li>Use the second mobile phone to scan and connect with PIC32CX-BZ.<br /></li> </ol> <h4 id="demo-mode"> <a href="readme.html#demo-mode" aria-labelledby="demo-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Demo Mode </h4> <ul> <li>Only Loopback Mode is supported for multi-link.</li> <li>Mobile app does not disallow the user to select the other demo mode since it can’t know if PIC32CX-BZ is under multi-link or not. Therefore, the user still can select the other demo mode on mobile app during multi-link. Note: If the user executes UART mode and connect two mobile phones with PIC32CX-BZ, then the PC tool is NOT able to identify the received UART data is sent from which mobile phone.<br /></li> </ul> <h2 id="3-interaction-of-both-pic32cx-bz-devices"> <a href="readme.html#3-interaction-of-both-pic32cx-bz-devices" aria-labelledby="3-interaction-of-both-pic32cx-bz-devices" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Interaction of both PIC32CX-BZ Devices </h2> <h3 id="31-supported-profile"> <a href="readme.html#31-supported-profile" aria-labelledby="31-supported-profile" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1. Supported Profile </h3> <ul> <li>Transparent Profile (TRP): MCHP proprietary profile, see Reference [4] for the detail.</li> </ul> <h3 id="32-the-topology-of-pic32cx-bz-to-pic32cx-bz"> <a href="readme.html#32-the-topology-of-pic32cx-bz-to-pic32cx-bz" aria-labelledby="32-the-topology-of-pic32cx-bz-to-pic32cx-bz" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2. The Topology of PIC32CX-BZ to PIC32CX-BZ: </h3> <ul> <li>The topology of PIC32CX-BZ to PIC32CX-BZ is one PIC32CX-BZ of a central device connects the other PIC32CX-BZ of a peripheral device.</li> <li>The central device is worked on a client role and the peripheral device is worked on a server role.</li> <li>The topology diagram:<br /> <img src="assets/markdown-img-paste-20201130111415568.png" alt="60" /></li> </ul> <h3 id="33-role-switch-between-a-central-device-and-a-peripheral-device"> <a href="readme.html#33-role-switch-between-a-central-device-and-a-peripheral-device" aria-labelledby="33-role-switch-between-a-central-device-and-a-peripheral-device" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3. Role Switch between a Central Device and a Peripheral Device </h3> <ul> <li>When a user turns on the power or presses the reset button, the default setting is the peripheral device which is advertising enable.</li> <li>When the user short presses a user button, the peripheral device is switched to a central device which is scanning enable.</li> <li>The user can short press the user button to switch the role between the central device and the peripheral device before the device connects any devices or the device is connected by any device.</li> </ul> <h3 id="34-ble-link-creation"> <a href="readme.html#34-ble-link-creation" aria-labelledby="34-ble-link-creation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4. BLE Link Creation </h3> <ul> <li>The central device sets the service data and the RSSI value of advertising report as filter conditions.</li> <li>If the service data of the received advertising report matches the filter condition and its RSSI value is larger or equal than a threshold (-40dBm, about 60 cm) or the largest in 5 seconds, the reporting device is the target device for BLE link connection.</li> <li>The central device triggers service discovery procedure and enables transparent profile after BLE link was connected.</li> <li>The user can long press the user button to disconnect the BLE link after BLE link was connected.</li> </ul> <h3 id="35-data-exchange-modes"> <a href="readme.html#35-data-exchange-modes" aria-labelledby="35-data-exchange-modes" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5. Data Exchange Modes </h3> <ul> <li>UART mode: <ul> <li>The data path of down link is PC tool -&gt; PIC32CX-BZ (Central device) -&gt; PIC32CX-BZ (Peripheral device) -&gt; PC tool.</li> <li>The data path of Up link is PC tool -&gt; PIC32CX-BZ (Peripheral device)-&gt; PIC32CX-BZ (Central device) -&gt; PC tool.</li> <li>The default setting is UART mode after transparent profile was enable.</li> </ul> </li> <li>Loopback mode: <ul> <li>The data path of loopback mode is PC tool -&gt; PIC32CX-BZ (Central device) -&gt; PIC32CX-BZ (Peripheral device) -&gt; PIC32CX-BZ (Central device) -&gt; PC tool.</li> </ul> </li> <li>Mode switch between two modes: <ul> <li>Switch condition: The central device and the peripheral device are at the idle state without data transmission. <ul> <li>Short press the user button to do mode switch.</li> </ul> </li> </ul> </li> </ul> <h3 id="36-led-indication"> <a href="readme.html#36-led-indication" aria-labelledby="36-led-indication" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.6. LED Indication </h3> <ul> <li>Peripheral device: <ul> <li>Advertising mode: Flash green LED one time every 500 ms.</li> <li>Connected mode: The green LED is always on.</li> </ul> </li> <li>Central device: <ul> <li>Scanning mode: Flash red LED one time every 500 ms.</li> <li>UART mode: The red LED is always on.</li> <li>Loopback mode: Flash red LED twice every 3 seconds.</li> <li>Reverse loopback mode: Flash red LED twice every 3 seconds. <h3 id="37-data-exchange-demo-procedures"> <a href="readme.html#37-data-exchange-demo-procedures" aria-labelledby="37-data-exchange-demo-procedures" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.7. Data Exchange Demo Procedures </h3> </li> </ul> </li> <li>UART mode <ol> <li>The user connects two WBZ451 Curiosity boards to PC by USB line.</li> <li>These two boards are the peripheral devices which flash green LED one time every 500 ms.</li> <li>The user selects one of the two boards to short press the user button and then this board becomes a central device. <br /> <img src="assets/markdown-img-paste-20201130133731266.png" alt="61" /></li> <li>The central device connects to the peripheral device and two devices are in UART mode.</li> <li>In connected mode, the peripheral device will have Green LED always on and the central device will have Red LED always on.</li> <li>Set COM port, Baudrate and enable H/W flow control and then press “Connect”: <br /> <img src="assets/markdown-img-paste-20201130134106384.png" alt="62" /></li> <li>Load File to select the target test pattern. <ul> <li>Then the user can check both “Compare Enable” and “Start Compare when Tx/Rx End” for Bi-direction UART test as below screenshot: <br /> <img src="assets/markdown-img-paste-20201130134354283.png" alt="63" /></li> <li>Or only check “Compare Enable” for Uni-direction UART test : <br /> <img src="assets/markdown-img-paste-20201130134438315.png" alt="64" /></li> </ul> </li> <li>Press “Tx Start” button to start transmitting data from one WBZ451 Curiosity board to the other one. <br /> <img src="assets/markdown-img-paste-20201130134637510.png" alt="65" /></li> <li>The user can select Uni-direction (up link or down link) UART test or Bi-direction UART test.</li> <li>PC Tool will show how many bytes it receives and will show the Compared Result after all data has been transmitted: <br /> <img src="assets/markdown-img-paste-20201130134806652.png" alt="66" /></li> </ol> </li> <li>Loopback mode <ol> <li>The user connects two WBZ451 Curiosity boards to PC by USB line.</li> <li>These two boards are the peripheral devices which flash green LED one time every 500 ms.</li> <li>The user selects one of the two boards to short press the user button and then this board becomes a central device. <br /> <img src="assets/markdown-img-paste-20201130133731266.png" alt="61" /></li> <li>The central device connects to the peripheral device and two devices are in UART mode.</li> <li>In connected mode, the peripheral device will have Green LED always on and the central device will have Red LED always on.</li> <li>The user short presses the user button of the central device to switch to loopback mode and then the central device will flash red LED twice every 3 seconds.</li> <li>Set COM port, Baudrate and enable H/W flow control and then press “Connect”: <br /> <img src="assets/markdown-img-paste-20201130134106384.png" alt="62" /></li> <li>Load File to select the target test pattern. <ul> <li>Then the user can check both “Compare Enable” and “Start Compare when Tx/Rx End” for loopback mode test as below screenshot: <br /> <img src="assets/markdown-img-paste-20201130134354283.png" alt="63" /></li> </ul> </li> <li>Press “Tx Start” button to start transmitting data from one WBZ451 Curiosity board to the other one and loopback to the original one. <br /> <img src="assets/markdown-img-paste-20201130134637510.png" alt="65" /></li> <li>PC Tool will show how many bytes it receives and will show the Compared Result after all data has been transmitted: <br /> <img src="assets/markdown-img-paste-20201130134806652.png" alt="66" /> <br /></li> </ol> </li> </ul> <h3 id="38-multi-link-for-central-role-demo"> <a href="readme.html#38-multi-link-for-central-role-demo" aria-labelledby="38-multi-link-for-central-role-demo" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.8. Multi-link For Central Role Demo </h3> <ul> <li>BLE UART v0.7.2 can achieve up to 6 devices multi-link when it works as Central role. (Connection establishment only, without massive data transmition)</li> <li>BLE UART v0.9.0.3 supports the Reverse Loopback mode for the massive data transmission.</li> <li>LED behavior: Refer to section <a href="readme.html#13-led-indication">1.3</a>.</li> <li>How to Establish the Second LE Link: Refer to section <a href="readme.html#14-button-control">1.4</a>. <br /></li> </ul> <h4 id="381--reverse-loopback-modes"> <a href="readme.html#381--reverse-loopback-modes" aria-labelledby="381--reverse-loopback-modes" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.8.1 Reverse Loopback Modes </h4> <ul> <li>Once the LE link is established, the Reverse Loopback mode can be performed by double clicking SW2 button.</li> <li>The data is generated and sent from each peripheral device to the central device, then loopback to each peripheral device. Each peripheral device will compare if the received data is the same with the transmitted data. Then the peripheral device will output a message via UART to indicate the comparison result. <ul> <li>Compared Pass message: “Reverse loopback is successful !”</li> <li>Compared failed message: “Reverse loopback content error !”</li> </ul> </li> <li>Note: PC is utilized to check the message of comparison result only.</li> <li>The data flow is illustrated in the below diagram: <br /> <img src="assets/markdown-img-paste-20211013666666666.png" alt="67" /> <br /></li> </ul> <h2 id="4-security-and-privacy"> <a href="readme.html#4-security-and-privacy" aria-labelledby="4-security-and-privacy" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Security and Privacy </h2> <h3 id="41-security"> <a href="readme.html#41-security" aria-labelledby="41-security" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.1 Security </h3> <ul> <li>If the pairng feature was activated by enabling the define in app.h, the “Encyption Permission” is required when the peer device attempts to send write request to PIC32CX-BZ to enable the Client Characteristic Configuration Descriptor (CCCD) of Transparent Service. Then the peer device will issue the pairing request due to the permission requirement.</li> <li>The IO capbility of BLE UART application is set as “NoInputNoOutput”, therefore, “Just Works” will be used for the key generation method.<br /></li> </ul> <h3 id="42-privacy"> <a href="readme.html#42-privacy" aria-labelledby="42-privacy" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.2 Privacy </h3> <ul> <li>If the user would like to update the Bluetooth device address on a frequent basis to reduce the ability to track a LE device over a period of time, Application could call BLE GAP API “BLE_GAP_SetLocalPrivacy()”. In BLE UART Application, it can be enabled by a build option “APP_PRIVACY_ENABLET”.</li> <li>If the resolvable private address is generated frequently, connection establishment times may be affected. It is recommended to set the timer to 15 minutes.</li> </ul> <h3 id="43-trusted-device-connectable-mode"> <a href="readme.html#43-trusted-device-connectable-mode" aria-labelledby="43-trusted-device-connectable-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4.3 Trusted Device Connectable Mode </h3> <ul> <li>In the Trusted Device Connectable Mode, application will add the paired device list into Resolving list and filter accept list then set the Advertising filter policy as “Process scan and connection requests only from the devices in the filter accept list.” Therefore, if the remote device is not in the filter accept list, it can NOT scan and connect with the local device (PIC32CX-BZ), which means only the trusted devices (the paired devices) can connect to PIC32CX-BZ.</li> <li>To include this mode, both of the build option “APP_PAIRING_ENABLE” and “APP_PRIVACY_ENABLE” are needed to be enabled.</li> <li>Use a UART command to enter/exit this mode: (Note: Refer to section <a href="readme.html#73-uart-commandevent-format">7.3</a> for the the detail information of UART command format.) <ul> <li>Enter: AA 00 06 40 03 0B 00 00 01 FF</li> <li>Exit: AA 00 06 40 03 0B 00 00 00 FF</li> </ul> </li> </ul> <h2 id="5-extended-adverting"> <a href="readme.html#5-extended-adverting" aria-labelledby="5-extended-adverting" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Extended Adverting </h2> <ul> <li>After enabling the build option “APP_EXT_ADV_ENABLE”, 2 sets of advertising will be activated which makes PIC32CX-BZ compatiable with the remote device supports or not supports Extended Adverting: <ul> <li>Legacy advertising.</li> <li>Extended Advertising with 2M PHY setting of secondary channel.</li> </ul> </li> <li>If the remote device supports Extended Adverting, the whole connection establishment will be based on 2M PHY, no need to issue PHY update to 2M PHY after the connection is established. <br /> (Note: The throughput of data transmition can be increased over 2M PHY link.)</li> <li>The maximum length of advertising data is increased to 251 bytes. (Legacy adverting only supports up to 31 bytes for adverting/scan response data.)</li> <li>Enable Extended Adverting will impact the power consumption.<br /></li> </ul> <h2 id="6-long-range"> <a href="readme.html#6-long-range" aria-labelledby="6-long-range" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Long Range </h2> <h3 id="61-introduction"> <a href="readme.html#61-introduction" aria-labelledby="61-introduction" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.1 Introduction </h3> <ul> <li>A user makes PHY change to the Coded PHY to approach the long range. There are two types of coding for the Coded PHY and these two types of coding are “S = 8” option and “S = 2” option. In BLE UART Application, the user can enable “APP_BLE_CODED_PHY_ENABLE” definition to get the long range function of “S = 8” option and enable “APP_BLE_CODED_PHY_ENABLE” and “APP_BLE_CODED_S2_ENABLE” definitions to get the long range function of “S = 2” option.</li> <li>The Coded PHY advertising is based on the extended advertising function to enable the advertising. In BLE statck, The extended advertising function, the extended scanning function and the extended create connection fuction are the same command set so the extended advertising function needs to use the extended scanning function and the extended create connection fuction for executing the scanning function and the create connection function.</li> </ul> <h3 id="62-data-exchange-demo-procedures"> <a href="readme.html#62-data-exchange-demo-procedures" aria-labelledby="62-data-exchange-demo-procedures" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2 Data Exchange Demo Procedures </h3> <ul> <li>When PIC32CX-BZ devices are loaded the image with the long range feature, they can be connected by the mobile phone with long range feature or they can be connected by each other with one for central device and the other for peripheral device.</li> </ul> <h4 id="621--the-mobile-phone-vs-the-pic32cx-bz-device"> <a href="readme.html#621--the-mobile-phone-vs-the-pic32cx-bz-device" aria-labelledby="621--the-mobile-phone-vs-the-pic32cx-bz-device" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2.1 The Mobile Phone V.S The PIC32CX-BZ Device </h4> <ul> <li>Please refer to section 2.</li> </ul> <h4 id="622-the-pic32cx-bz-devices"> <a href="readme.html#622-the-pic32cx-bz-devices" aria-labelledby="622-the-pic32cx-bz-devices" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2.2 The PIC32CX-BZ Devices </h4> <ul> <li>Please refer to section 3.</li> </ul> <h4 id="623-the-link-loss-distance-measurement-and-the-maximum-link-distatnce-measurement"> <a href="readme.html#623-the-link-loss-distance-measurement-and-the-maximum-link-distatnce-measurement" aria-labelledby="623-the-link-loss-distance-measurement-and-the-maximum-link-distatnce-measurement" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.2.3 The Link Loss Distance Measurement and The Maximum Link Distatnce Measurement </h4> <ul> <li>Making both PIC32CX-BZ devices connected in 0.3 meters to do data exchange and Taking the PIC32CX-BZ Central Device away to measure the Link Lost Distance.</li> <li>Go back to the PIC32CX-BZ Peripheral Device every 25 meters and try to initiate BLE connection with data exchange. It is recorded as the Maximum Link Distatnce.</li> </ul> <h3 id="63-notification"> <a href="readme.html#63-notification" aria-labelledby="63-notification" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6.3 Notification </h3> <ul> <li>More barriers and interference will cause the shorter link distance.</li> <li>In order to approach optimal communication distance performance, using smaller packets, suitable connection interval and supervision timeout are the key factors. <ul> <li>For example, the data length of application layer is no longer than 20 bytes and the connection interval is 20 ms and the supervision timeout is 720 ms.</li> </ul> </li> </ul> <h2 id="7-supplement"> <a href="readme.html#7-supplement" aria-labelledby="7-supplement" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Supplement </h2> <h3 id="71-throughput-filed-test-report"> <a href="readme.html#71-throughput-filed-test-report" aria-labelledby="71-throughput-filed-test-report" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.1. Throughput Filed Test Report </h3> <h4 id="-with-mobile-phones"> <a href="readme.html#-with-mobile-phones" aria-labelledby="-with-mobile-phones" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> -With Mobile Phones </h4> <p>The below tables shows the throughput filed test report with iOS and Android devices.<br /></p> <ul> <li>Profile: Transparent Profile</li> <li>Operation Type: <ul> <li>Downlink (Mobile App -&gt; PIC32CX -&gt; UART output to PC): Write Command</li> <li>Uplink (UART input from PC -&gt; PIC32CX -&gt; Mobile App): Notification <ol> <li>iOS Device:</li> </ol> </li> </ul> </li> </ul> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Phones</th> <th style="text-align: center">Downlink (Kbytes/sec)</th> <th style="text-align: center">Uplink (Kbytes/sec)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">iPhone 6 Plus / iOS 12.4.8</td> <td style="text-align: center">5.61</td> <td style="text-align: center">5.62</td> </tr> <tr> <td style="text-align: center">iPhone 7 / iOS 13.5.1</td> <td style="text-align: center">18.64</td> <td style="text-align: center">19.23</td> </tr> <tr> <td style="text-align: center">iPhone 8 / iOS 11.1</td> <td style="text-align: center">47.08</td> <td style="text-align: center">47.62</td> </tr> <tr> <td style="text-align: center">iPhone X / iOS 12.3</td> <td style="text-align: center">57.93</td> <td style="text-align: center">58.82</td> </tr> <tr> <td style="text-align: center">iPhone X MAX / iOS 14.0.1</td> <td style="text-align: center">55.17</td> <td style="text-align: center">62.5</td> </tr> <tr> <td style="text-align: center">iPhone 11 / iOS 14.0.1</td> <td style="text-align: center">60.29</td> <td style="text-align: center">62.5</td> </tr> <tr> <td style="text-align: center">iPad Air 3rd / iOS 13.3</td> <td style="text-align: center">58.62</td> <td style="text-align: center">58.82</td> </tr> </tbody> </table></div> <ol> <li>Android Device:</li> </ol> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Phones</th> <th style="text-align: center">Downlink (Kbytes/sec)</th> <th style="text-align: center">Uplink (Kbytes/sec)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">Samsung S10 /Android 10</td> <td style="text-align: center">46</td> <td style="text-align: center">65</td> </tr> <tr> <td style="text-align: center">OPPO RENO /Android 9</td> <td style="text-align: center">36</td> <td style="text-align: center">66</td> </tr> <tr> <td style="text-align: center">Sony Xperia XZ /Android 8</td> <td style="text-align: center">4</td> <td style="text-align: center">4</td> </tr> <tr> <td style="text-align: center">Vivo V11 /Android 9</td> <td style="text-align: center">32</td> <td style="text-align: center">66</td> </tr> <tr> <td style="text-align: center">Nokia 7.2 /Android 10</td> <td style="text-align: center">35</td> <td style="text-align: center">64</td> </tr> <tr> <td style="text-align: center">OPPO R15 /Android 9</td> <td style="text-align: center">42</td> <td style="text-align: center">66</td> </tr> <tr> <td style="text-align: center">OnePlus 3 /Android 9</td> <td style="text-align: center">33</td> <td style="text-align: center">41</td> </tr> <tr> <td style="text-align: center">Google Pixel 2 /Android 10</td> <td style="text-align: center">50</td> <td style="text-align: center">67</td> </tr> </tbody> </table></div> <h4 id="-pic32cx-bz-vs-pic32cx-bz"> <a href="readme.html#-pic32cx-bz-vs-pic32cx-bz" aria-labelledby="-pic32cx-bz-vs-pic32cx-bz" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> -PIC32CX-BZ v.s PIC32CX-BZ </h4> <p>The below table shows the throughput filed test report of PIC32CX-BZ v.s PIC32CX-BZ.</p> <ul> <li>Profile: Transparent Profile</li> <li>Operation Type: <ul> <li>Downlink (UART input from PC -&gt; PIC32CX (Central) -&gt; PIC32CX (Peripheral) -&gt; UART output to PC): Write Command</li> <li>Uplink (UART input from PC -&gt; PIC32CX (Peripheral) -&gt; PIC32CX (Central) -&gt; UART output to PC): Notification</li> </ul> </li> </ul> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Downlink (Kbytes/sec)</th> <th style="text-align: center">Uplink (Kbytes/sec)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">60</td> <td style="text-align: center">66</td> </tr> </tbody> </table></div> <h3 id="72-how-to-achieve-maximum-throughput-with-smart-phones"> <a href="readme.html#72-how-to-achieve-maximum-throughput-with-smart-phones" aria-labelledby="72-how-to-achieve-maximum-throughput-with-smart-phones" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.2. How to Achieve Maximum Throughput with Smart Phones </h3> <p>There are primarily 4 factors which determine the maximum throughput of BLE:</p> <ol> <li>Operation type used to transfer data</li> <li>Connection interval</li> <li>Number of packets transmitted within a connection event</li> <li>Data size of each packet<br /></li> </ol> <p>And the throughput can be expressed as: Throughput = Number of Packets * Data Size of each Packet / Connection Interval<br /></p> <h4 id="operation-type"> <a href="readme.html#operation-type" aria-labelledby="operation-type" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Operation Type </h4> <ul> <li>From Transparent Profile Client to Server, it is suggested to utilize “Write Command” instead of “Write Request” since a Request requires a round trip Response from the Server before another message is sent.</li> <li>From Transparent Profile Server to Client, it is suggested to utilize “Notification” instead of “Indication” since a Indications requires a round trip Confirmation to be sent before another message is sent.<br /></li> </ul> <h4 id="connection-interval"> <a href="readme.html#connection-interval" aria-labelledby="connection-interval" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Connection Interval </h4> <p>The connection paramters are negotiated by the peer device and PIC32CX-BZ.<br /> Lower connection interval will improve the throughput performance but will impact the power consumption.<br /> The range of connection interval supported by PIC32CX-BZ is 7.5 ms ~ 4 sec.<br /> However, differnet mobile phones might support differnet range of the connection parameters.<br /> For example, Apple provies “Accessory Design Guidelines for Apple Devices” [6] to define the acceptable connection parameters. All the accessories should follow this guideline and request the connection parameters appropriately.<br /> But Google doesn’t provide this kind of guideline for Android devices. Therefore, the connection paramters range of the Android device might depend on the OEMs.<br /> In BLE UART Application, PIC32CX-BZ will issue the connection parameter update procedure to update the connection interval as 20 ms once the peer device enbles the Client Characteristic Configuration Descriptor(CCCD) of the Control Point in Transparent Servcie [1].<br /></p> <h4 id="number-of-packets-transmitted-within-a-connection-event"> <a href="readme.html#number-of-packets-transmitted-within-a-connection-event" aria-labelledby="number-of-packets-transmitted-within-a-connection-event" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Number of Packets Transmitted Within a Connection Event </h4> <p>PIC32CX-BZ supports upto 13 packets transmitted within a connection event under 2M PHY.<br /> However, the capbility of the peer device needs to be considered as well.<br /> Each mobile phone has its own bandwidth mangement.<br /> For iOS device, it suppports upto 5~6 packets transmitted within a connection event under 2M PHY.<br /> For Android device, it depends on the OEMs.<br /></p> <h4 id="data-size-of-each-packet"> <a href="readme.html#data-size-of-each-packet" aria-labelledby="data-size-of-each-packet" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Size of Each Packet </h4> <p>For GATT, the maximum amount of data in each packet is the maximum ATT MTU size (247 bytes) subtracted by the ATT header size (3 bytes).<br /></p> <h4 id="limitation-of-uart"> <a href="readme.html#limitation-of-uart" aria-labelledby="limitation-of-uart" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Limitation of UART </h4> <p>Some MCUs might only support up to 921600 bps (112.5 kbytes/sec) UART baudrate.<br /> However, the maximum value of BLE data throughput might exceed the UART baudrate.<br /> For example, the connection interval is negotiated as 20 ms. And the number of packets within a connection event is 13.<br /> Thus, the theoretical throughput value is 244 bytes * 13 / 20 ms = 154.88 kbytes/sec.<br /> Therefore, the UART baudrate might be the bottleneck under some cases. <br /></p> <h4 id="note"> <a href="readme.html#note" aria-labelledby="note" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Note: </h4> <ol> <li>Coded PHY is not used for throughput measurement since it is designed to extend the rannge of data transmission at the cost of throughput reduced.</li> <li>It is suggested that the distance between PIC32CX-BZ and the peer device is within 1 meter during a throughput measurement. The longer distance will result in the weaker signal strength. <br /></li> </ol> <h3 id="73-uart-commandevent-format"> <a href="readme.html#73-uart-commandevent-format" aria-labelledby="73-uart-commandevent-format" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.3. UART Command/Event Format </h3> <ul> <li>The UART command/event are desgined for the test purpose. Host side (such as PC tool) could issue an UART command to trigger an action of PIC32CX-BZ.<br /> And PIC32CX-BZ could report current status or related information via an UART event. In BLE UART Application, UART command/event can be enabled by a build option “APP_UART_CMD_SET_ENABLE”.</li> <li>The format of UART command is defined as:</li> </ul> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">Start Byte</th> <th style="text-align: center">Length*</th> <th style="text-align: center">Type**</th> <th style="text-align: center">Payload</th> <th style="text-align: center">End Byte</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">Length</td> <td style="text-align: center">1 Byte</td> <td style="text-align: center">2 Bytes</td> <td style="text-align: center">1 Byte</td> <td style="text-align: center">(Lengh - 1) Bytes</td> <td style="text-align: center">1 Byte</td> </tr> <tr> <td style="text-align: center">Value</td> <td style="text-align: center">0xAA</td> <td style="text-align: center">0xXXXX</td> <td style="text-align: center">0x40</td> <td style="text-align: center">0xXX….XX</td> <td style="text-align: center">0xFF</td> </tr> </tbody> </table></div> <p>*Note: The Lengh field indicates the total lengh of Type and Payload fields, excludes the Start Byte, Length and End Byte fields. **Note: The Type field indicates this packet is an UART command.<br /></p> <ul> <li>The format of UART event is defined as:</li> </ul> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">Start Byte</th> <th style="text-align: center">Length*</th> <th style="text-align: center">Type**</th> <th style="text-align: center">Payload</th> <th style="text-align: center">End Byte</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">Length</td> <td style="text-align: center">1 Byte</td> <td style="text-align: center">2 Bytes</td> <td style="text-align: center">1 Byte</td> <td style="text-align: center">(Lengh - 1) Bytes</td> <td style="text-align: center">2 Byte</td> </tr> <tr> <td style="text-align: center">Value</td> <td style="text-align: center">0xAA</td> <td style="text-align: center">0xXXXX</td> <td style="text-align: center">0x50</td> <td style="text-align: center">0xXX….XX</td> <td style="text-align: center">0xFFFF</td> </tr> </tbody> </table></div> <p>*Note: The Lengh field indicates the total lengh of Type and Payload fields, excludes the Start Byte, Length and End Byte fields. **Note: The Type field indicates this packet is an UART event.<br /></p> <h3 id="74-set-bluetooth-device-address"> <a href="readme.html#74-set-bluetooth-device-address" aria-labelledby="74-set-bluetooth-device-address" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7.4. Set Bluetooth Device Address </h3> <p>BLE SDK provides an API: “BLE_GAP_SetDeviceAddr()” to let Application set the Bluetooth Device Address.<br /> This API shall be called after “BLE_GAP_Init()”. <br /></p> <h2 id="8-sleep-mode"> <a href="readme.html#8-sleep-mode" aria-labelledby="8-sleep-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Sleep Mode </h2> <h3 id="81-how-to-use-mplab-code-configurator-mcc-to-configure-sleep-mode"> <a href="readme.html#81-how-to-use-mplab-code-configurator-mcc-to-configure-sleep-mode" aria-labelledby="81-how-to-use-mplab-code-configurator-mcc-to-configure-sleep-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.1. How to use MPLAB® Code Configurator (MCC) to Configure Sleep Mode </h3> <ol> <li>Enable Sleep Mode option in the BLE stack module. - The RTC component will be added automatically. <br /> <img src="assets/markdown-img-paste-20211014134057755.png" alt="68" /> <br /></li> <li>Set the low power clock source as Primary Oscillator (POSC) via clock configurator.<br /> <img src="assets/markdown-img-paste-20211014135218367.png" alt="69" /> <br /></li> <li>Follow the user guide in “app_user_edits.c” to add a few code manually.</li> <li>Note: In BLE UART application, the sleep mode feature is included but it’s disabled by default setting. Enable the build option “ENABLE_SLEEP_MODE” to activate this feature.</li> </ol> <h3 id="82-the-scope-of-sleep-mode"> <a href="readme.html#82-the-scope-of-sleep-mode" aria-labelledby="82-the-scope-of-sleep-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.2. The Scope of Sleep Mode </h3> <ul> <li>Sleep mode includes BT sleep and system sleep. These two modes are individual features.</li> <li>In BT sleep mode, only BT enters sleep.The system might or might not enter sleep.</li> <li>In system sleep mode: <ul> <li>During system sleep, most of clock will be disabled and the low power clock is utilized. The Primary oscillator (POSC) is selected as the low power clock source.</li> <li>PMU will be configured as BUCK_PSM mode once the system enters sleep. And it will be restored as BUCK_PWM mode when the system exits sleep mode.</li> <li>During system sleep, the system tick is turned off as well. RTC is utilized as the secondary timer due to it still works during sleep mode. Therefore, RTC based tickless idle mode is performed.</li> <li>System is not allowed to enter sleep if BT is active, it means if BT is not in sleep mode, then the system can not sleep either.</li> </ul> </li> </ul> <h2 id="reference"> <a href="readme.html#reference" aria-labelledby="reference" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Reference </h2> <p>[1] Microchip Transparent Service_v1.1<br /> [2] Microchip Transparent Credit Based Service v1.0<br /> [3] https://www.bluetooth.com/specifications/gatt/<br /> [4] Microchip Transparent Profile_v1.1<br /> [5] Microchip Transparent Credit Based Profile_v1.0<br /> [6] https://developer.apple.com/accessories/Accessory-Design-Guidelines.pdf<br /></p> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='http://10.12.80.161:4000/wireless/assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2022 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
