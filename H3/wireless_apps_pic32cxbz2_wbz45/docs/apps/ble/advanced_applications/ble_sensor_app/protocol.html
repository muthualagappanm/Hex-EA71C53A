<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="http://10.12.80.161:4000/wireless/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>BLE Sensor (Protocol Exchange) | Microchip MPLAB Harmony Wireless help</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="BLE Sensor (Protocol Exchange)" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony Wireless package" /> <meta property="og:description" content="Harmony Wireless package" /> <link rel="canonical" href="protocol.html" /> <meta property="og:url" content="http://10.12.80.161:4000/wireless/apps/ble/advanced_applications/ble_sensor_app/protocol.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony Wireless help" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="BLE Sensor (Protocol Exchange)" /> <script type="application/ld+json"> {"@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://10.12.80.161:4000/wireless/assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"http://10.12.80.161:4000/wireless/apps/ble/advanced_applications/ble_sensor_app/protocol.html","headline":"BLE Sensor (Protocol Exchange)","description":"Harmony Wireless package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="protocol.html#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="../../../../index.html" class="nav-list-link">Mplab Code Configurator Wireless Package</a></li><li class="nav-list-item active"><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../readme.html" class="nav-list-link">Examples applications</a><ul class="nav-list "><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/readme.html" class="nav-list-link">BLE Building Blocks</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../building_blocks/peripheral/readme.html" class="nav-list-link">Peripheral Building Blocks</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/scan_ext_adv/readme.html" class="nav-list-link">BLE Extended Scan</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/readme.html" class="nav-list-link">Central Building Blocks</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/connection/readme.html" class="nav-list-link">BLE Connection(Central)</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/profiles_services/readme.html" class="nav-list-link">BLE Profiles and Services (Central)</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/profiles_services/trp_uart/readme.html" class="nav-list-link">Central Transparent UART</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/profiles_services/ml_trp_uart/readme.html" class="nav-list-link">Multi Transparent UART</a> </li><li class="nav-list-item "> <a href="../../building_blocks/chip_peripherals/uart/readme.html" class="nav-list-link">UART Demo</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/freertos_ble_stack_init_central.html" class="nav-list-link">Freetos Stack Init</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/legacy_adv_sleep/readme.html" class="nav-list-link">Legacy Advertisement</a> </li><li class="nav-list-item "> <a href="../../building_blocks/central/legacy_scan/readme.html" class="nav-list-link">Legacy Scan</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/connection/readme.html" class="nav-list-link">Peripheral Connection</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/ext_adv/readme.html" class="nav-list-link">Extended Advertisement</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/profiles_services/readme.html" class="nav-list-link">Profile and Services</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/profiles_services/custom_service/readme.html" class="nav-list-link">Custom Service</a> </li><li class="nav-list-item "> <a href="../../building_blocks/peripheral/profiles_services/trp_uart/readme.html" class="nav-list-link">Proprietary UART Service</a> </li></ul></li><li class="nav-list-item active"><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../readme.html" class="nav-list-link">BLE Advance Applications</a><ul class="nav-list"><li class="nav-list-item "> <a href="../ble_uart_demo/readme.html" class="nav-list-link">BLE UART Demo</a> </li><li class="nav-list-item "> <a href="readme.html" class="nav-list-link">BLE Sensor DEMO</a> </li><li class="nav-list-item active"> <a href="protocol.html" class="nav-list-link active">BLE Sensor (Protocol Exchange)</a> </li></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../zigbee/readme.html" class="nav-list-link">Zigbee</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../zigbee/low_power_configuration.html" class="nav-list-link">Zigbee Low Power Config</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_commissioning.html" class="nav-list-link">Zigbee Commissioning Procedure</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_greenpower.html" class="nav-list-link">Zigbee Green Power</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_project_generation.html" class="nav-list-link">Zigbee Application Project Generation</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_security_model.html" class="nav-list-link">Zigbee Network Security Models</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_combined_interface/readme.html" class="nav-list-link">Zigbee Combined Interface</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_lights/readme.html" class="nav-list-link">Zigbee Light</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_lights/readme_distributed.html" class="nav-list-link">Zigbee light Distributed Network</a> </li><li class="nav-list-item "> <a href="../../../zigbee/zigbee_multisensor/readme.html" class="nav-list-link">Zigbee multisensor</a> </li></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../multiprotocol/readme.html" class="nav-list-link">Multiprotocol</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_basic/readme.html" class="nav-list-link">BLE+ZIGBEE Application</a> </li><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_light_prov/readme.html" class="nav-list-link">Multiprotocol Demo App</a> </li><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_light_prov/protocol.html" class="nav-list-link">Multiprotocol Demo</a> </li><li class="nav-list-item "> <a href="../../../multiprotocol/ble_zigbee_multiSensor_prov/readme.html" class="nav-list-link">Zigbee Multi-Sensor, commissioning App</a> </li></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../docs/readme.html" class="nav-list-link">User Docs</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../zigbee/consoleCommands.html" class="nav-list-link">Serial Console Commands</a> </li><li class="nav-list-item "> <a href="../../../docs/lowpower.html" class="nav-list-link">Low Power</a> </li><li class="nav-list-item "> <a href="../../../docs/user_action.html" class="nav-list-link">User Action</a> </li><li class="nav-list-item "> <a href="../../../docs/generate_code.html" class="nav-list-link">MCC Code Generation</a> </li><li class="nav-list-item "> <a href="../../../docs/creating_new_mplabx_harmony_project.html" class="nav-list-link">Generating New MCC Harmony Code</a> </li><li class="nav-list-item "> <a href="../../../docs/pic32cx_bz2_wbz45x_sdk_setup.html" class="nav-list-link">SDK Setup</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../../release_notes.html" class="nav-list-link">Release notes</a><ul class="nav-list "><li class="nav-list-item "><a href="../ble_uart_demo/release_notes.html" class="nav-list-link">BLE UART Demo</a></li><li class="nav-list-item "><a href="release_notes.html" class="nav-list-link">BLE Sensor</a></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/chip_peripherals/uart/release_notes.html" class="nav-list-link">UART Hello World</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/legacy_adv_sleep/release_notes.html" class="nav-list-link">BLE Legacy Adv</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/ext_adv/release_notes.html" class="nav-list-link">BLE Extended Advertising</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/connection/release_notes.html" class="nav-list-link">BLE Connection (Peripheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/peripheral/profiles_services/custom_service/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/connection/release_notes.html" class="nav-list-link">BLE Connection (Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/legacy_scan/release_notes.html" class="nav-list-link">BLE Legacy Scan</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/profiles_services/ml_trp_uart/release_notes.html" class="nav-list-link">BLE Multilink Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="protocol.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../building_blocks/central/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="../../building_blocks/central/scan_ext_adv/release_notes.html" class="nav-list-link">BLE Scan Extended Advertising</a></li><li class="nav-list-item "><a href="../../../multiprotocol/ble_zigbee_light_prov/release_notes.html" class="nav-list-link">Zigbee Multiprotocol Lights Prov App</a></li><li class="nav-list-item "><a href="../../../multiprotocol/ble_zigbee_multiSensor_prov/release_notes.html" class="nav-list-link">Zigbee Multi-Sensor and commissioning</a></li><li class="nav-list-item "><a href="../../../zigbee/zigbee_lights/release_notes.html" class="nav-list-link">Zigbee Combined Interface App</a></li><li class="nav-list-item "><a href="../../../zigbee/zigbee_combined_interface/release_notes.html" class="nav-list-link">Zigbee Combined Interface App</a></li><li class="nav-list-item "><a href="../../../zigbee/zigbee_multisensor/release_notes.html" class="nav-list-link">Zigbee Multi-Sensor</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony Wireless help" aria-label="Search Microchip MPLAB Harmony Wireless help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../../readme.html">Examples applications</a></li> <li class="breadcrumb-nav-list-item"><a href="../readme.html">BLE Advance Applications</a></li> <li class="breadcrumb-nav-list-item"><span>BLE Sensor (Protocol Exchange)</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a> # WBZ451 BLE Sensor DEMO : Protocol Exchange</p> <h2 id="protocol-exchange"> <a href="protocol.html#protocol-exchange" aria-labelledby="protocol-exchange" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Protocol Exchange </h2> <p>The communication protocol exchange between mobile app (BLE central) and WBZ451 module (BLE peripheral) is explained here. <a name="adv"> </a></p> <h3 id="1-ble-sensor-data-in-advertising-beacon"> <a href="protocol.html#1-ble-sensor-data-in-advertising-beacon" aria-labelledby="1-ble-sensor-data-in-advertising-beacon" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. BLE Sensor Data in Advertising Beacon: </h3> <p align="left"> <img src="images/adv_struct.jpg" width="500" height="150" /> </p> <ul> <li>Advertisement Data: <ul> <li>Service UUID: 16-bit Service UUID, 0xFEDA is purchased by Microchip from Bluetooth SIG.</li> <li>BLE Sensor data: 0x40+Light ON/Off status (1 Byte)+ 0x41+Temperature data (2 bytes)</li> </ul> </li> <li>Scan Response Data: <ul> <li>The device name is part of the scan response. Device name is set as “BLE_SENSOR_XXXX” (XXXX means the last two bytes of the device address).</li> </ul> </li> </ul> <p><a name="trps"> </a></p> <h3 id="2-transparent-profile-and-service-trptrs"> <a href="protocol.html#2-transparent-profile-and-service-trptrs" aria-labelledby="2-transparent-profile-and-service-trptrs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Transparent Profile and Service (TRP/TRS): </h3> <p>Transparent Profile and Service (TRP/TRS) is the proprietary BLE service by microchip to establish data and control channel between BLE Central (Phone) and Peripheral (device).</p> <p align="left"> <img src="images/trps_block_diagram.png" width="500" height="450" /> </p> <ul> <li>Transparent Profile (TRP) enables higher layer application to control and allow data exchange between TRP Client and Server devices</li> <li>Transparent Service (TRS) includes both Ctrl and Data Pipes which are custom 128-bit GATT characteristics. <ul> <li>The Transparent Server shall be a GATT Server</li> <li> <p>The Transparent Client shall be a GATT Client</p> <p><strong>Definition of Transparent Service and Characteristics UUID’s</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Characteristic Name</th> <th style="text-align: center">UUID</th> <th style="text-align: right">Properties</th> <th> </th> </tr> </thead> <tbody> <tr> <td style="text-align: left">TRS Service</td> <td style="text-align: center">49535343-FE7D-4AE5-8FA9-9FAFD205E455</td> <td style="text-align: right"> </td> <td> </td> </tr> <tr> <td style="text-align: left">TRS TxD- Tx Data to Client role (Data pipe)</td> <td style="text-align: center">49535343-1E4D-4BD9-BA61-23C647249616</td> <td style="text-align: right">Notify, Write</td> <td> </td> </tr> <tr> <td style="text-align: left">TRS TxD - Client Characteristic Configuration Descriptor</td> <td style="text-align: center"> </td> <td style="text-align: right">Read, Write</td> <td> </td> </tr> <tr> <td style="text-align: left">TRS RxD- Rx Data from Client role (Data pipe)</td> <td style="text-align: center">49535343-8841-43F4-A8D4-ECBE34729BB3</td> <td style="text-align: right">Write, Write without response</td> <td> </td> </tr> <tr> <td style="text-align: left">TRS Ctrl Pt - Command and Response (Ctrl pipe)</td> <td style="text-align: center">49535343-4C8A-39B3-2F49-511CFF073B7E</td> <td style="text-align: right">Notify, Write, Write without response</td> <td> </td> </tr> <tr> <td style="text-align: left">TRS Ctrl Pt - Client Characteristic Configuration descriptor</td> <td style="text-align: center"> </td> <td style="text-align: right">Read, Write</td> <td>{:.table-striped}</td> </tr> </tbody> </table></div> </li> </ul> </li> </ul> <h3 id="3-ble-sensor-application-over-transparent-service-control-point-trs-ctrl-pt"> <a href="protocol.html#3-ble-sensor-application-over-transparent-service-control-point-trs-ctrl-pt" aria-labelledby="3-ble-sensor-application-over-transparent-service-control-point-trs-ctrl-pt" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. BLE Sensor Application over Transparent Service Control Point (TRS Ctrl Pt): </h3> <p>BLE Sensor application uses TRS Control Point Characteristic of TRPS profile to exchange data between mobile phone and device.</p> <p align="left"> <img src="images/trps_sensor.png" width="600" height="400" /> </p> <p>The BLE Sensor application follows the below protocol format on TRS control point characteristic.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Item</th> <th style="text-align: center">Opcode</th> <th style="text-align: right">Length</th> <th style="text-align: right">Sensor/Control ID</th> <th style="text-align: right">Payload</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">Size</td> <td style="text-align: center">1 Byte</td> <td style="text-align: right">1 Byte</td> <td style="text-align: right">1 Byte</td> <td style="text-align: right">Variable</td> </tr> </tbody> </table></div> <p>The description of each element is as below:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- The Opcode: (0x8A) is fixed 1 byte in size and related to BLE Sensor/Control commands.
- Length: 1 byte in size (size of Sensor/Control ID + size of Payload)
- The Sensor/Control ID: 1 byte in size. It could be divided into Control request, Control response, Sensor notify data described in detail in following sections.
- The Sensor/control data and payload size depends on the Sensor/Control ID as listed in the below table.
</code></pre></div></div> <p><strong>BLE sensor application control and sensor command/response</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th><strong>Control Cmd</strong></th> <th><strong>Opcode</strong></th> <th><strong>Control Request ID</strong></th> <th><strong>Parameter</strong></th> <th><strong>Parameter Length (Byte)</strong></th> <th><strong>Control Response ID</strong></th> <th><strong>Control Response Payload</strong></th> <th><strong>Control Response Payload Length (Byte)</strong></th> <th><strong>Description</strong></th> </tr> </thead> <tbody> <tr> <td>RGB LED On/Off Set</td> <td>0x8A</td> <td>0x10</td> <td>On/Off</td> <td>1</td> <td>0x20</td> <td>Status code</td> <td>1</td> <td>Switch On/Off the RGB LED with the default/last set color</td> </tr> <tr> <td>RGB LED On/Off Get</td> <td>0x8A</td> <td>0x11</td> <td> </td> <td> </td> <td>0x21</td> <td>Status code + On/Off status</td> <td>2</td> <td>Send the RGB LED on/off status</td> </tr> <tr> <td>RGB Color Set</td> <td>0x8A</td> <td>0x12</td> <td>Color value (HSV)</td> <td>3</td> <td>0x22</td> <td>Status code</td> <td>1</td> <td>Set RGB color value in HSV format</td> </tr> <tr> <td>RGB Color Get</td> <td>0x8A</td> <td>0x13</td> <td> </td> <td> </td> <td>0x23</td> <td>Status code + RGB color value</td> <td>4</td> <td>Send RGB color value in HSV format</td> </tr> <tr> <td><strong>Sensor Data</strong></td> <td> </td> <td> </td> <td> </td> <td> </td> <td><strong>Sensor ID</strong></td> <td><strong>Parameter</strong></td> <td><strong>Parameter Length (Byte)</strong></td> <td><strong>Description</strong></td> </tr> <tr> <td>RGB LED On/Off status</td> <td>0x8A</td> <td> </td> <td> </td> <td> </td> <td>0x40</td> <td>On/Off status</td> <td>1</td> <td>RGB LED On/Off Status</td> </tr> <tr> <td>Temperature data</td> <td>0x8A</td> <td> </td> <td> </td> <td> </td> <td>0x41</td> <td>Temperature sensor data</td> <td>2</td> <td>Temperature value in Celsius with 0.1 resolution. The MSB bit will be set when the negative temperature is reported</td> </tr> </tbody> </table></div> <h4 id="31-control-command-request-and-response"> <a href="protocol.html#31-control-command-request-and-response" aria-labelledby="31-control-command-request-and-response" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1 Control Command Request and Response </h4> <p>The Control command request is used by mobile app to send the command to device. The control request channel is opened only after Client Characteristic Configuration Descriptor of TRS Ctrl Pt Characteristic notification is enabled; it is closed when such notification is disabled.</p> <p>The format of Control command is an 8bit Opcode, an 8bit request ID followed by optional control payload.</p> <p><strong>Format of Control Command</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th><strong>Item</strong></th> <th>Op Code</th> <th>Length</th> <th>Control Request ID</th> <th>Control Payload</th> </tr> </thead> <tbody> <tr> <td><strong>Size (Octet)</strong></td> <td>1</td> <td>1</td> <td>1</td> <td>Variable</td> </tr> </tbody> </table></div> <p>The control response is used by the device to send feedback to mobile app. The format of Response is an 8bit Opcode, an 8bit response ID and response status followed by optional Response payload.</p> <p><strong>Format of Control Response Data</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th><strong>Item</strong></th> <th>Op Code</th> <th>Length</th> <th>Control Response ID</th> <th>Status</th> <th>Control Response Payload</th> </tr> </thead> <tbody> <tr> <td><strong>Size (Octet)</strong></td> <td>1</td> <td>1</td> <td>1</td> <td>1</td> <td>Variable</td> </tr> </tbody> </table></div> <p>Status code 0x00 means successful execution of control command. Any status code other than 0x00 means error code, as shown in below Table. An error status does not have optional control Response payload.</p> <p><strong>Definition of Status Code</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th><strong>Status Code</strong></th> <th><strong>Definition</strong></th> <th><strong>Description</strong></th> </tr> </thead> <tbody> <tr> <td><strong>0x00</strong></td> <td>Success</td> <td>Response for successful operation</td> </tr> <tr> <td><strong>0x01</strong></td> <td>Op Code Not Supported</td> <td>Response if unsupported Op Code is received</td> </tr> <tr> <td><strong>0x02</strong></td> <td>Invalid Parameter</td> <td>Response if Parameter received does not meet the requirements of the service.</td> </tr> <tr> <td><strong>0x03</strong></td> <td>Operation Fail</td> <td>Response for fail operation</td> </tr> <tr> <td><strong>0x04-0xFF</strong></td> <td>Reserved for Future use</td> <td> </td> </tr> </tbody> </table></div> <h4 id="32-sensor-notify-data"> <a href="protocol.html#32-sensor-notify-data" aria-labelledby="32-sensor-notify-data" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2 Sensor Notify Data </h4> <p>The Sensor data is sent to mobile app periodically by WBZ451 device. The sensor data channel is opened only after Client Characteristic Configuration Descriptor of TRS Ctrl Pt notification is enabled; it is closed when such notification is disabled.</p> <p>The format of sensor data is an 8bit Opcode, an 8bit Sensor ID followed by sensor data payload.</p> <p><strong>Format of Sensor Data</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th><strong>Item</strong></th> <th>Op Code</th> <th>Length</th> <th>Sensor ID</th> <th>Sensor Payload</th> </tr> </thead> <tbody> <tr> <td><strong>Size (Octet)</strong></td> <td>1</td> <td>1</td> <td>1</td> <td>Variable</td> </tr> </tbody> </table></div> <hr /> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='http://10.12.80.161:4000/wireless/assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2022 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
